# 2025-11-29 iOS WebView íŒì—… ìˆ˜ì • ì‘ì—…

## ëª©í‘œ
nice.checkplus.co.kr ë³¸ì¸ì¸ì¦ íŒì—…ì´ iOS WebViewì—ì„œ ì‘ë™í•˜ë„ë¡ ìˆ˜ì •

## ë¬¸ì œì 
- iOS WebViewì—ì„œ `window.open()` íŒì—…ì´ ì‘ë™í•˜ì§€ ì•ŠìŒ
- íŒì—…ì´ ëœ¬ í›„ì—ë„ ë¹ˆ í™”ë©´ìœ¼ë¡œ í‘œì‹œë¨

## í•´ê²° ë°©ë²•

### 1. javaScriptCanOpenWindowsAutomatically ì„¤ì • ì¶”ê°€
**íŒŒì¼:** `SefraiOS/ViewController.swift` (56ë²ˆ ì¤„)
```swift
preferences.javaScriptCanOpenWindowsAutomatically = true
```
- ì´ ì„¤ì •ì´ ì—†ìœ¼ë©´ JavaScriptì˜ `window.open()` í˜¸ì¶œì´ ë¬´ì‹œë¨

### 2. íŒì—… WebView ìƒì„± êµ¬í˜„
**íŒŒì¼:** `SefraiOS/ViewController.swift` (275-297ë²ˆ ì¤„)
```swift
func webView(_ webView: WKWebView, createWebViewWith configuration: WKWebViewConfiguration,
             for navigationAction: WKNavigationAction, windowFeatures: WKWindowFeatures) -> WKWebView? {
    // ìƒˆë¡œìš´ íŒì—… WebView ìƒì„±
    let popup = WKWebView(frame: view.bounds, configuration: configuration)
    popup.navigationDelegate = self
    popup.uiDelegate = self
    self.popupWebView = popup

    // íŒì—…ì„ í™”ë©´ì— ì¶”ê°€
    view.addSubview(popup)
    // ... Auto Layout ì„¤ì • ...

    popup.load(URLRequest(url: url))
    return popup
}
```

### 3. íŒì—… ìë™ ì¢…ë£Œ ì²˜ë¦¬
**íŒŒì¼:** `SefraiOS/ViewController.swift` (9ë²ˆ ì¤„, 299-305ë²ˆ ì¤„)
```swift
private var popupWebView: WKWebView?  // í”„ë¡œí¼í‹° ì¶”ê°€

// íŒì—… ë‹«ê¸° ì²˜ë¦¬ (JavaScript window.close() í˜¸ì¶œ ì‹œ)
func webViewDidClose(_ webView: WKWebView) {
    if webView == popupWebView {
        popupWebView?.removeFromSuperview()
        popupWebView = nil
    }
}
```
- ë‚˜ì´ìŠ¤ ì¸ì¦ ì™„ë£Œ í›„ `window.close()` ëª…ë ¹ìœ¼ë¡œ ìë™ ì¢…ë£Œ

## ë²„ì „ ì •ë³´

### ë³€ê²½ ì‚¬í•­
- ë²„ì „: 1.0 â†’ 1.1 (íŒ¨í‚¤ì§€ ë²„ì „)
- ë¹Œë“œ: 61 â†’ 62 â†’ 63

### ë²„ì „ ìˆ˜ì • ìœ„ì¹˜
1. **Info.plist** - CFBundleShortVersionString, CFBundleVersion
2. **project.pbxproj** - MARKETING_VERSION, CURRENT_PROJECT_VERSION
3. **package.json** - version

## Git ì»¤ë°‹ ì´ë ¥

| í•´ì‹œ | ì»¤ë°‹ ë©”ì‹œì§€ | íŒŒì¼ | ë¹Œë“œ |
|------|-----------|------|------|
| 684cfc1 | Fix window.open() popup support for nice.checkplus.co.kr authentication | Info.plist, ViewController.swift, project.pbxproj, package.json | 62 |
| 01b12d9 | Fix popup WebView not loading content properly | ViewController.swift | 62 |
| df8eae6 | Update build number to 63 and simplify popup handling | Info.plist, project.pbxproj, ViewController.swift | 63 |
| 5dae4ae | Fix popup window reference and auto-close handling | ViewController.swift | 63 |

## ë¹Œë“œí•  ë•Œ í™•ì¸ ì‚¬í•­

### 1. ì»¤ë°‹/í‘¸ì‹œ ì „ í™•ì¸
```bash
git status          # ë³€ê²½ì‚¬í•­ í™•ì¸
git diff            # ì½”ë“œ ë³€ê²½ ìƒì„¸ í™•ì¸
git log -1          # ìµœê·¼ ì»¤ë°‹ í™•ì¸
```

### 2. ë²„ì „ ìˆ˜ì • ê·œì¹™
- **íŒ¨í‚¤ì§€ ë²„ì „** (1.0, 1.1): ì£¼ìš” ê¸°ëŠ¥ ì¶”ê°€/ë³€ê²½ ì‹œì—ë§Œ ì¦ê°€
- **ë¹Œë“œ ë²ˆí˜¸** (61, 62, 63): ë§¤ ë¹Œë“œë§ˆë‹¤ +1
- í•œ ë²ˆì— í•œ ê³³ì”©ë§Œ ìˆ˜ì •!

### 3. ì»¤ë°‹ ì „ ìˆ˜ì •í•  íŒŒì¼
```
1. SefraiOS/Info.plist (CFBundleVersionë§Œ +1)
2. SefraiOS.xcodeproj/project.pbxproj (CURRENT_PROJECT_VERSIONë§Œ +1)
3. ìˆ˜ì • ì½”ë“œê°€ ìˆìœ¼ë©´ í•´ë‹¹ íŒŒì¼ë“¤
```

### 4. ì»¤ë°‹ ë©”ì‹œì§€ í˜•ì‹
```
[ê¸°ëŠ¥] ê°„ë‹¨í•œ ì„¤ëª…

- ìƒì„¸ ì„¤ëª… 1
- ìƒì„¸ ì„¤ëª… 2

ğŸ¤– Generated with Claude Code

Co-Authored-By: Claude <noreply@anthropic.com>
```

### 5. í‘¸ì‹œ
```bash
git push origin ios-app
```

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **ë¹Œë“œ ë²ˆí˜¸ëŠ” ë§¤ë²ˆ +1ì”©ë§Œ ì¦ê°€**
   - 63 â†’ 64 â†’ 65 (ìˆœì°¨ì )

2. **íŒ¨í‚¤ì§€ ë²„ì „ì€ ì‹ ì¤‘í•˜ê²Œ**
   - 1.1 ìœ ì§€ (ë‹¤ìŒ ë³€ê²½ ì‹œì—ë§Œ 1.2ë¡œ)

3. **ëª¨ë“  íŒŒì¼ì—ì„œ ë²„ì „ ì¼ê´€ì„± ìœ ì§€**
   - Info.plist
   - project.pbxproj
   - package.json (í•„ìš”ì‹œ)

4. **ë¹Œë“œí•˜ê¸° ì „ ìµœì‹  ì½”ë“œ í™•ì¸**
   - `git log` ë¡œ ìµœì‹  ì»¤ë°‹ í™•ì¸
   - `git push` í›„ GitHubì— ë°˜ì˜ í™•ì¸

## WebAuthn ë“±ë¡ ì˜¤ë¥˜ ë¶„ì„ (ë¹Œë“œ 64 ì´í›„)

### ë¬¸ì œ
ê¸°ê¸° ë“±ë¡ ì‹œ "Value "" is not valid" ì˜¤ë¥˜ ë°œìƒ

### ì›ì¸ (ì•ˆë“œë¡œì´ë“œ ì½”ë“œ í™•ì¸)
ì•ˆë“œë¡œì´ë“œë„ ë™ì¼í•˜ê²Œ ë”ë¯¸ê°’ ì‚¬ìš©:
```kotlin
val attestationObject = "android_biometric_attestation"
val attestationBase64 = android.util.Base64.encodeToString(attestationObject.toByteArray(), ...)
```

**ë”°ë¼ì„œ ë¬¸ì œëŠ” ë‹¤ë¥¸ ê³³ì— ìˆìŒ!**

ì‹¤ì œ ë¬¸ì œ:
- iOS `getFCMToken()` â†’ ë¹ˆ ë¬¸ìì—´ ë°˜í™˜
- ì•ˆë“œë¡œì´ë“œ `getFCMToken()` â†’ ì‹¤ì œ FCM í† í° ë°˜í™˜ (SharedPreferencesì—ì„œ)

### í•´ê²°ì±…
1. **FCM í† í°ì„ JavaScript localStorageì— ì €ì¥** (ì´ë¯¸ ìˆ˜ì •ë¨)
   - `sendFCMTokenToWeb()` í•¨ìˆ˜ì—ì„œ `localStorage.setItem('fcm_token', token)` ì¶”ê°€

2. **getFCMToken()ì´ localStorageì—ì„œ ì½ë„ë¡** (ì´ë¯¸ ìˆ˜ì •ë¨)
   - `return localStorage.getItem('fcm_token') || ''`

3. **sendFCMTokenToServer() í˜¸ì¶œ í™•ì¸**
   - í˜ì´ì§€ ë¡œë“œ í›„ 1ì´ˆ ë’¤ ìë™ í˜¸ì¶œ
   - localStorageì— í† í° ì €ì¥ë¨ì„ í™•ì¸

**í˜„ì¬ ìƒíƒœ: âœ… ì´ë¯¸ ìˆ˜ì •ë¨ (ì»¤ë°‹ a4b03d4)**

## ìµœì¢… í˜„í™©

âœ… javaScriptCanOpenWindowsAutomatically ì¶”ê°€
âœ… íŒì—… WebView ìƒì„± êµ¬í˜„
âœ… íŒì—… ìë™ ì¢…ë£Œ ì²˜ë¦¬
âœ… íŒì—… SafeArea ìœ„ì¹˜ ì¡°ì •
âœ… ë²„ì „ 1.1 (ë¹Œë“œ 64)
âœ… GitHub ios-app ë¸Œëœì¹˜ì— ëª¨ë‘ í‘¸ì‹œë¨

âš ï¸ WebAuthn ì„œë²„ API ì—°ë™ í•„ìš” (ë‹¤ìŒ ë¹Œë“œì—ì„œ ì²˜ë¦¬)
