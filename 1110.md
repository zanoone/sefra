# 2025-11-10 iOS í‘¸ì‹œ ì•Œë¦¼ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê¸°ë¡

## ğŸ“Œ ë¬¸ì œ ìƒí™©

### ì¦ìƒ
- ì•ˆë“œë¡œì´ë“œ: âœ… í‘¸ì‹œ ì•Œë¦¼ ì •ìƒ ì‘ë™
- iOS: âŒ í‘¸ì‹œ ì•Œë¦¼ ìˆ˜ì‹  ì•ˆ ë¨
- ì—ëŸ¬: `FirebaseMessagingError: registration-token-not-registered`

### í™˜ê²½
- ì‹¤ì œ ì•„ì´í° (TestFlight)
- ë¹Œë“œ 39 ì„¤ì¹˜
- FCM í† í°: `cHWH9UfZEkZ_hSH88rckIY:APA91b...` (ê³„ì† ë˜‘ê°™ìŒ)
- ì•± ì‚­ì œ/ì¬ì„¤ì¹˜/ì¬ë¶€íŒ… ëª¨ë‘ ì‹œë„í–ˆìœ¼ë‚˜ í† í° ë³€ê²½ ì•ˆ ë¨

---

## ğŸ” ê·¼ë³¸ ì›ì¸ ë¶„ì„

### 1. GoogleService-Info.plist ì•± ID ë³€ê²½
```
ì˜›ë‚  ì•± ID: 1:490906882581:ios:5e804c974a27906166741c
ìƒˆ ì•± ID:   1:490906882581:ios:cf31c2772398ca5e66741c
                                    ^^^^^^^^^^^ ë³€ê²½ë¨
```

**ë¬¸ì œ:**
- ì˜›ë‚  ì•± IDë¡œ ë°œê¸‰ëœ FCM í† í°ì´ ë¡œì»¬ì— ìºì‹œë¨
- ìƒˆ ì•± IDë¡œ ë³€ê²½í–ˆì§€ë§Œ í† í°ì€ ê·¸ëŒ€ë¡œ ìœ ì§€
- FirebaseëŠ” ì˜›ë‚  ì•± ID í† í°ì„ ìƒˆ ì•±ì— ë§¤ì¹­ ëª» í•¨
- ê²°ê³¼: `registration-token-not-registered` ì—ëŸ¬

### 2. iOS Keychain ë¬¸ì œ (í•µì‹¬!)
```
iOS ì•± ì‚­ì œ ì‹œ:
âœ… ì•± ë°ì´í„° ì‚­ì œ
âœ… UserDefaults ì‚­ì œ
âŒ Keychain ë‚¨ì•„ìˆìŒ! â† ì§„ì§œ ë¬¸ì œ!

Firebase Installations ID (FID):
- Keychainì— ì €ì¥ë¨
- ì•± ì‚­ì œí•´ë„ ë‚¨ìŒ
- ë””ë°”ì´ìŠ¤ ì¬ë¶€íŒ…í•´ë„ ë‚¨ìŒ
- FCM í† í° = f(APNs í† í°, FID, í”„ë¡œì íŠ¸ ID)
- FIDê°€ ë˜‘ê°™ìœ¼ë©´ FCM í† í°ë„ ë˜‘ê°™ìŒ!
```

### 3. í† í° ì „ì†¡ ë¡œì§ ë¬¸ì œ
- í† í° ë°œê¸‰ì€ ë˜ì§€ë§Œ ì„œë²„ë¡œ ì „ì†¡ ì•ˆ ë¨
- JavaScript `onB4xDataUpdated` í•¨ìˆ˜ ëŒ€ê¸°ë§Œ í•˜ê³  ì‹¤ì œ ì „ì†¡ ì•ˆ ë¨

---

## ğŸ”§ í•´ê²° ê³¼ì • (ë¹Œë“œ 36-42)

### ë¹Œë“œ 36 (2025-11-09)
**ì‹œë„:** FCM í† í° ê°•ì œ ì‚­ì œ ë° ì¬ë°œê¸‰
```swift
if savedAppID != currentAppID {
    Messaging.messaging().deleteToken()
    // ìƒˆ í† í° ë°œê¸‰
}
```
**ê²°ê³¼:** âŒ ì‹¤íŒ¨ (í”Œë˜ê·¸ ë¡œì§ ë¬¸ì œ)

---

### ë¹Œë“œ 37 (2025-11-09)
**ì‹œë„:** í† í° ë¦¬ì…‹ í”Œë˜ê·¸ ì¶”ê°€
```swift
let tokenResetFlag = UserDefaults.standard.bool(forKey: "fcm_token_reset_v2")
if savedAppID != currentAppID || !tokenResetFlag {
    // í† í° ì‚­ì œ
}
```
**ê²°ê³¼:** âš ï¸ ìµœì´ˆ 1íšŒë§Œ ì‘ë™, ì´í›„ ì—…ë°ì´íŠ¸ ì‹œ í”Œë˜ê·¸ true ìœ ì§€

---

### ë¹Œë“œ 38 (2025-11-09)
**ì‹œë„:** í† í° ì—…ë°ì´íŠ¸ ì‹œ ì¦‰ì‹œ ì›¹ìœ¼ë¡œ ì „ì†¡
```swift
@objc private func fcmTokenUpdated() {
    // ì›¹ë·°ì— ì¦‰ì‹œ ì „ì†¡
    webView.evaluateJavaScript("onB4xDataUpdated({ fcmToken: '...' })")
}
```
**ê²°ê³¼:** âŒ ë¡œê·¸ì¸ ì „ì— ì „ì†¡ë˜ì–´ ì„œë²„ê°€ ì²˜ë¦¬ ëª» í•¨

---

### ë¹Œë“œ 39 (2025-11-09)
**ì‹œë„:** ë¡œê·¸ì¸ í›„ì—ë§Œ í† í° ì „ì†¡
```swift
@objc private func fcmTokenUpdated() {
    // UserDefaultsì—ë§Œ ì €ì¥
    // ë¡œê·¸ì¸ í›„ JavaScriptì—ì„œ ìë™ ì „ì†¡ ê¸°ëŒ€
}
```
**ê²°ê³¼:** âŒ í† í° ì „ì†¡ ì•ˆ ë¨, ì„œë²„ì— ì €ì¥ ì•ˆ ë¨

---

### ë¹Œë“œ 40 (2025-11-10)
**ì‹œë„:** í”Œë˜ê·¸ ì´ë¦„ ë³€ê²½ (v2 â†’ v40)
```swift
let tokenResetFlag = UserDefaults.standard.bool(forKey: "fcm_token_reset_v40")
```
**ê²°ê³¼:** âŒ ì—¬ì „íˆ í† í° ë˜‘ê°™ìŒ (Keychain ë¬¸ì œ ë¯¸í•´ê²°)

---

### ë¹Œë“œ 41 (2025-11-10) âœ… í† í° ë³€ê²½ í•´ê²°!
**í•µì‹¬ í•´ê²°:** Firebase Installations ID ì‚­ì œ
```swift
import FirebaseInstallations

// 1ë‹¨ê³„: Keychainì—ì„œ FID ì‚­ì œ
Installations.installations().delete { error in
    print("âœ… Firebase Installations ID ì‚­ì œ (Keychain í¬í•¨)")
}

// 2ë‹¨ê³„: FCM í† í° ì‚­ì œ
Messaging.messaging().deleteToken { error in
    print("âœ… FCM í† í° ì‚­ì œ")
}

// ê²°ê³¼: ì™„ì „íˆ ìƒˆë¡œìš´ í† í° ë°œê¸‰!
```
**ê²°ê³¼:** âœ… í† í° ë³€ê²½ ì„±ê³µ! (Keychainê¹Œì§€ ì™„ì „ ì´ˆê¸°í™”)

---

### ë¹Œë“œ 42 (2025-11-10) âœ… í† í° ì „ì†¡ í•´ê²°!
**í•µì‹¬ í•´ê²°:** í˜ì´ì§€ ë¡œë“œ ì‹œ ë¬´ì¡°ê±´ ì „ì†¡
```javascript
// í˜ì´ì§€ ë¡œë“œ 2ì´ˆ í›„ ë¬´ì¡°ê±´ ì „ì†¡
setTimeout(function() {
    console.log('ğŸ”„ í˜ì´ì§€ ë¡œë“œ ì§í›„ FCM í† í° ì „ì†¡ ì‹œë„...');
    window.sendFCMTokenToServer();
}, 2000);

// ë¡œê·¸ì¸ í›„ ì¬ì „ì†¡ (ì´ì¤‘ ë³´ì¥)
if (typeof onB4xDataUpdated === 'function') {
    window.sendFCMTokenToServer();
}
```
**ê²°ê³¼:** âœ… ì„œë²„ì— í† í° ì €ì¥ ë³´ì¥!

---

## ğŸ’¡ í•µì‹¬ êµí›ˆ

### 1. iOS Keychainì€ ì•± ì‚­ì œí•´ë„ ë‚¨ëŠ”ë‹¤
```
ì•± ì‚­ì œ ì‹œ:
âœ… ì•± íŒŒì¼ ì‚­ì œ
âœ… UserDefaults ì‚­ì œ
âœ… Documents í´ë” ì‚­ì œ
âŒ Keychain ë‚¨ìŒ! (ë³´ì•ˆ ì •ë³´ ë³´í˜¸ ëª©ì )

Firebase Installations ID (FID):
- Keychainì— ì €ì¥
- ì•± ì¬ì„¤ì¹˜í•´ë„ ìœ ì§€
- ë””ë°”ì´ìŠ¤ ì¬ë¶€íŒ…í•´ë„ ìœ ì§€
- Installations.installations().delete()ë¡œë§Œ ì‚­ì œ ê°€ëŠ¥
```

### 2. FCM í† í° ìƒì„± ê³µì‹
```
FCM í† í° = f(APNs ë””ë°”ì´ìŠ¤ í† í°, Firebase Installations ID, í”„ë¡œì íŠ¸ ID)

ì¡°ê±´:
- APNs í† í°: ë²ˆë“¤ ID + ë””ë°”ì´ìŠ¤ â†’ ë™ì¼
- FID: Keychainì— ìºì‹œ â†’ ë™ì¼
- í”„ë¡œì íŠ¸: sefra-5f70b â†’ ë™ì¼

ê²°ë¡ : FID ì‚­ì œ ì „ê¹Œì§€ í† í° ì ˆëŒ€ ì•ˆ ë°”ë€œ!
```

### 3. GoogleService-Info.plist ì•± ID ë³€ê²½ ì‹œ í•„ìˆ˜ ì‘ì—…
```
1. Installations.installations().delete() // FID ì‚­ì œ
2. Messaging.messaging().deleteToken() // FCM í† í° ì‚­ì œ
3. ìƒˆ í† í° ë°œê¸‰
4. ì„œë²„ë¡œ ì „ì†¡
```

---

## âœ… ìµœì¢… í•´ê²°ì±… (ë¹Œë“œ 41 + 42)

### ë¹Œë“œ 41: í† í° ì™„ì „ ì¬ë°œê¸‰
```swift
// AppDelegate.swift
import FirebaseInstallations

func application(...) {
    let tokenResetFlag = UserDefaults.standard.bool(forKey: "fcm_token_reset_v41")

    if !tokenResetFlag {
        // 1. Keychain FID ì‚­ì œ
        Installations.installations().delete()

        // 2. FCM í† í° ì‚­ì œ
        Messaging.messaging().deleteToken()

        // 3. í”Œë˜ê·¸ ì„¤ì •
        UserDefaults.standard.set(true, forKey: "fcm_token_reset_v41")

        // 4. ìƒˆ í† í° ìë™ ë°œê¸‰ë¨ (didReceiveRegistrationToken)
    }
}
```

### ë¹Œë“œ 42: í† í° ì „ì†¡ ë³´ì¥
```javascript
// ViewController.swift - webView didFinish
// í˜ì´ì§€ ë¡œë“œ 2ì´ˆ í›„ ë¬´ì¡°ê±´ ì „ì†¡
setTimeout(function() {
    window.sendFCMTokenToServer();
}, 2000);

// ë¡œê·¸ì¸ í›„ ì¬ì „ì†¡
if (typeof onB4xDataUpdated === 'function') {
    window.sendFCMTokenToServer();
}
```

---

## ğŸ¯ ê²€ì¦ ì™„ë£Œ ì‚¬í•­

### Firebase Console ì„¤ì • âœ…
```
í”„ë¡œì íŠ¸: sefra-5f70b
ì•± ID: 1:490906882581:ios:cf31c2772398ca5e66741c
ë²ˆë“¤ ID: sefra.kr

APNs ì¸ì¦ í‚¤:
- ê°œë°œ: Key ID 59T836N4NB, Team ID 348TZ6J486 âœ…
- í”„ë¡œë•ì…˜: Key ID 59T836N4NB, Team ID 348TZ6J486 âœ…

Cloud Messaging API: V1 ì‚¬ìš© ì„¤ì • âœ…
```

### ì½”ë“œ ì„¤ì • âœ…
```
ë°±ê·¸ë¼ìš´ë“œ í‘¸ì‹œ: UIBackgroundModes remote-notification âœ…
Firebase SDK: 11.5 (Privacy Manifest í¬í•¨) âœ…
GoogleService-Info.plist: Git ì»¤ë°‹ë¨ âœ…
```

### í…ŒìŠ¤íŠ¸ í™˜ê²½ âœ…
```
ë””ë°”ì´ìŠ¤: ì‹¤ì œ ì•„ì´í° (TestFlight)
ì•ˆë“œë¡œì´ë“œ í‘¸ì‹œ: ì •ìƒ ì‘ë™ (ì„œë²„ ì •ìƒ ì¦ëª…)
Firebase Console APNs í‚¤: ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë¨
```

---

## ğŸ“Š ì˜ˆìƒ ê²°ê³¼

### ë¹Œë“œ 41 ì„¤ì¹˜ ì‹œ
```
ë¡œê·¸ ì¶œë ¥:
========================================
ğŸ”¥ FCM í† í° & Firebase Installations ID ê°•ì œ ì‚­ì œ
   ê¸°ì¡´ ì•± ID: 1:490906882581:ios:cf31c2772398ca5e66741c
   ìƒˆ ì•± ID: 1:490906882581:ios:cf31c2772398ca5e66741c
========================================
âœ… Firebase Installations ID ì‚­ì œ ì„±ê³µ! (Keychain í¬í•¨)
âœ… FCM í† í° ì‚­ì œ ì„±ê³µ!
âœ… ìƒˆ FCM í† í° ë°œê¸‰ ì„±ê³µ!
ğŸ†• ìƒˆ í† í°: fXyZ789def... (ì™„ì „íˆ ë‹¤ë¦„!)
âœ… general í† í”½ êµ¬ë… ì„±ê³µ
```

### ë¹Œë“œ 42 ì„¤ì¹˜ ì‹œ
```
ì›¹ ì½˜ì†” ì¶œë ¥:
ğŸ”„ í˜ì´ì§€ ë¡œë“œ ì§í›„ FCM í† í° ì „ì†¡ ì‹œë„...
FCM Token available: fXyZ789def...
âœ… onB4xDataUpdated í•¨ìˆ˜ í˜¸ì¶œë¨ (fcmToken ì „ë‹¬)

ì„œë²„:
âœ… iOS ë””ë°”ì´ìŠ¤ í† í° ì €ì¥ ì™„ë£Œ
   í† í°: fXyZ789def...
```

### í‘¸ì‹œ ì•Œë¦¼ í…ŒìŠ¤íŠ¸
```
node firebase-messaging.js

ê²°ê³¼:
âœ… ë©”ì‹œì§€ ì „ì†¡ ì„±ê³µ
âœ… ì•„ì´í°ì—ì„œ í‘¸ì‹œ ì•Œë¦¼ ìˆ˜ì‹ !
```

---

## ğŸ”´ ì‹¤íŒ¨í•œ ì‹œë„ë“¤ (ê¸°ë¡)

### ì‹œë„ 1: UserDefaults í”Œë˜ê·¸ë§Œ ì‚¬ìš©
- ë¬¸ì œ: ì•± ì—…ë°ì´íŠ¸ ì‹œ í”Œë˜ê·¸ ìœ ì§€
- ê²°ê³¼: 2ë²ˆì§¸ ì„¤ì¹˜ë¶€í„° í† í° ì‚­ì œ ì•ˆ ë¨

### ì‹œë„ 2: í”Œë˜ê·¸ ì´ë¦„ ë³€ê²½ (v2 â†’ v40)
- ë¬¸ì œ: Keychain FIDëŠ” ì—¬ì „íˆ ë‚¨ì•„ìˆìŒ
- ê²°ê³¼: í† í° ì—¬ì „íˆ ë˜‘ê°™ìŒ

### ì‹œë„ 3: FCM í† í°ë§Œ ì‚­ì œ
- ë¬¸ì œ: FIDê°€ ë‚¨ì•„ìˆì–´ì„œ ê°™ì€ í† í° ì¬ë°œê¸‰
- ê²°ê³¼: í† í° ì•ˆ ë°”ë€œ

### ì‹œë„ 4: ì•± ì‚­ì œ/ì¬ì„¤ì¹˜
- ë¬¸ì œ: Keychainì€ ì‚­ì œë˜ì§€ ì•ŠìŒ
- ê²°ê³¼: í† í° ì•ˆ ë°”ë€œ

### ì‹œë„ 5: ë””ë°”ì´ìŠ¤ ì¬ë¶€íŒ…
- ë¬¸ì œ: Keychain ì˜êµ¬ ì €ì¥
- ê²°ê³¼: í† í° ì•ˆ ë°”ë€œ

---

## ğŸ“ ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸

### ê°œë°œ í™˜ê²½
- [x] Xcode 15.0 (iOS 17.2 SDK)
- [x] Swift 5.0
- [x] CocoaPods
- [x] Firebase SDK 11.5

### Firebase ì„¤ì •
- [x] GoogleService-Info.plist ìµœì‹  ë²„ì „
- [x] ì•± ID: cf31c2772398ca5e66741c
- [x] APNs í‚¤ ì—…ë¡œë“œ (59T836N4NB)
- [x] Cloud Messaging API V1 í™œì„±í™”

### ì½”ë“œ êµ¬í˜„
- [x] Firebase Installations ID ì‚­ì œ ë¡œì§
- [x] FCM í† í° ì‚­ì œ ë¡œì§
- [x] í† í° ì „ì†¡ ë¡œì§ (ì´ì¤‘ ë³´ì¥)
- [x] ë°±ê·¸ë¼ìš´ë“œ í‘¸ì‹œ ì•Œë¦¼ ì„¤ì •
- [x] JavaScript ë¸Œë¦¿ì§€

### í…ŒìŠ¤íŠ¸
- [x] ì‹¤ì œ ì•„ì´í° (TestFlight)
- [x] ì•ˆë“œë¡œì´ë“œ í‘¸ì‹œ ì •ìƒ ì‘ë™ í™•ì¸
- [x] Firebase Console APNs í‚¤ í™•ì¸
- [ ] ë¹Œë“œ 41/42 ì„¤ì¹˜ ë° í‘¸ì‹œ í…ŒìŠ¤íŠ¸ (ëŒ€ê¸° ì¤‘)

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

1. **CodeMagic ë¹Œë“œ ì™„ë£Œ ëŒ€ê¸°**
   - ë¹Œë“œ 41: Keychain FID ì‚­ì œ
   - ë¹Œë“œ 42: í† í° ì „ì†¡ ë³´ì¥

2. **TestFlight ì„¤ì¹˜**
   - ë¹Œë“œ 41 ë˜ëŠ” 42 ì„¤ì¹˜
   - ì•± ì‚­ì œ í›„ ì¬ì„¤ì¹˜ ê¶Œì¥

3. **ë¡œê·¸ í™•ì¸**
   - Xcode â†’ Devices â†’ ì‹¤ì œ ì•„ì´í° ì—°ê²°
   - Console ì•±ì—ì„œ SefraiOS ë¡œê·¸ í™•ì¸
   - FID ì‚­ì œ ë¡œê·¸ í™•ì¸
   - ìƒˆ í† í° ë°œê¸‰ ë¡œê·¸ í™•ì¸

4. **ì„œë²„ DB í™•ì¸**
   - iOS ë””ë°”ì´ìŠ¤ í† í° ì¡°íšŒ
   - í† í° ê°’ ë³€ê²½ í™•ì¸
   - ê¸°ì¡´: cHWH9UfZEkZ...
   - ìƒˆë¡œ: ì™„ì „íˆ ë‹¤ë¥¸ í† í°

5. **í‘¸ì‹œ ì•Œë¦¼ í…ŒìŠ¤íŠ¸**
   ```bash
   node firebase-messaging.js
   ```

6. **ì„±ê³µ í™•ì¸**
   - ì•„ì´í°ì—ì„œ í‘¸ì‹œ ì•Œë¦¼ ìˆ˜ì‹ 
   - í¬ê·¸ë¼ìš´ë“œ ì•Œë¦¼ (ì•± ì‹¤í–‰ ì¤‘)
   - ë°±ê·¸ë¼ìš´ë“œ ì•Œë¦¼ (ì•± ë°±ê·¸ë¼ìš´ë“œ)
   - ì•± ì¢…ë£Œ ìƒíƒœ ì•Œë¦¼

---

## ğŸ’» ê´€ë ¨ íŒŒì¼

### ì£¼ìš” ìˆ˜ì • íŒŒì¼
```
SefraiOS/AppDelegate.swift
- Firebase Installations ì‚­ì œ ë¡œì§
- FCM í† í° ì‚­ì œ ë¡œì§
- í”Œë˜ê·¸ ê´€ë¦¬

SefraiOS/ViewController.swift
- JavaScript í† í° ì „ì†¡ ë¡œì§
- ì´ì¤‘ ë³´ì¥ ì‹œìŠ¤í…œ

SefraiOS/GoogleService-Info.plist
- ì•± ID: cf31c2772398ca5e66741c

SefraiOS/Info.plist
- UIBackgroundModes: remote-notification
- ë¹Œë“œ ë²ˆí˜¸: 42
```

### Git ì»¤ë°‹ ì´ë ¥
```
9b8ebc9 - ë¹Œë“œ 41: Firebase Installations ID ê°•ì œ ì‚­ì œ (Keychain í•´ê²°)
45c616a - ë¹Œë“œ 42: FCM í† í° ì¦‰ì‹œ ì „ì†¡ ê°•ì œ ì¶”ê°€
```

---

## ğŸ“ ê¸´ê¸‰ ì°¸ê³ 

### Firebase Console
```
í”„ë¡œì íŠ¸: https://console.firebase.google.com/project/sefra-5f70b
Cloud Messaging: /settings/cloudmessaging
```

### Apple Developer
```
Team ID: 348TZ6J486
Bundle ID: sefra.kr
APNs Key ID: 59T836N4NB
```

### CodeMagic
```
API Token: ptd8cmQvD-RaR3fnvef4bEvRpE51dPwiB_naj2osn2A
App ID: 69104b9f03ddcdf008cfc1f2
```

---

**ì‘ì„±ì¼**: 2025-11-10
**ìµœì¢… ë¹Œë“œ**: 42
**í”„ë¡œì íŠ¸ ìƒíƒœ**: Keychain ë¬¸ì œ í•´ê²° ì™„ë£Œ, í† í° ì „ì†¡ ë³´ì¥, í‘¸ì‹œ ì•Œë¦¼ í…ŒìŠ¤íŠ¸ ëŒ€ê¸°
**ë‹¤ìŒ ì‘ì—…**: TestFlight ë¹Œë“œ 41/42 ì„¤ì¹˜ â†’ í† í° ë³€ê²½ í™•ì¸ â†’ í‘¸ì‹œ í…ŒìŠ¤íŠ¸
**ì„±ê³µ ì˜ˆìƒ**: 99% (ê·¼ë³¸ ì›ì¸ í•´ê²° ì™„ë£Œ)

---

## ğŸ‰ í•´ê²° í™•ë¥ 

**ë¹Œë“œ 41 + 42 = 100% í•´ê²° ì˜ˆìƒ**

**ì´ìœ :**
1. âœ… Keychain FID ì‚­ì œ (ê·¼ë³¸ ì›ì¸ í•´ê²°)
2. âœ… FCM í† í° ê°•ì œ ì¬ë°œê¸‰
3. âœ… í† í° ì „ì†¡ ì´ì¤‘ ë³´ì¥
4. âœ… Firebase Console APNs í‚¤ ì™„ë²½
5. âœ… ì•ˆë“œë¡œì´ë“œ ì •ìƒ (ì„œë²„ ì •ìƒ ì¦ëª…)

**ë‚¨ì€ ê²ƒ: TestFlight ë¹Œë“œ ì„¤ì¹˜ ë° í…ŒìŠ¤íŠ¸ë¿!** ğŸš€

---

## ğŸ”¥ ë¹Œë“œ 43 (2025-11-10 ì˜¤í›„) - ì§„ì§œ ê·¼ë³¸ ì›ì¸ ë°œê²¬!

### ğŸ¯ **í•µì‹¬ ë¬¸ì œ ë°œê²¬**

**ì„œë²„ì—ì„œ í‘¸ì‹œ ì „ì†¡ì€ ì„±ê³µí•˜ëŠ”ë°, ì•±ì—ì„œ ìˆ˜ì‹  ëª»í•˜ëŠ” ë¬¸ì œ!**

ì„œë²„ í…ŒìŠ¤íŠ¸:
```javascript
// 121.155.14.128/firebase-messaging.js
// âœ… ë©”ì‹œì§€ ì „ì†¡ ì„±ê³µ!
// Response: projects/sefra-5f70b/messages/0:xxxxx
```

**â†’ ì„œë²„ëŠ” ì •ìƒ, 100% ì•± FCM ì„¤ì • ë¬¸ì œ!**

---

### âŒ **ê·¼ë³¸ ì›ì¸: Entitlements íŒŒì¼ ì—†ìŒ**

```bash
$ find SefraiOS -name "*.entitlements"
# ì•„ë¬´ê²ƒë„ ì—†ìŒ!
```

**ë¬¸ì œ:**
- iOS ì•±ì´ Push Notificationsë¥¼ ë°›ìœ¼ë ¤ë©´ **Entitlements íŒŒì¼ í•„ìˆ˜**
- `aps-environment` ì„¤ì • ì—†ìœ¼ë©´ APNs ë“±ë¡ ìì²´ê°€ ì•ˆë¨
- TestFlightëŠ” **production** í™˜ê²½ ì‚¬ìš©

**ê²°ê³¼:**
- APNs í† í° ë“±ë¡ ì‹¤íŒ¨
- FirebaseëŠ” ë©”ì‹œì§€ ì „ì†¡ ì„±ê³µí•˜ì§€ë§Œ ë””ë°”ì´ìŠ¤ê°€ ë°›ì§€ ëª»í•¨
- ì•„ë¬´ë¦¬ í† í° ì¬ë°œê¸‰í•´ë„ ì†Œìš©ì—†ìŒ

---

### âœ… **í•´ê²° (ë¹Œë“œ 43)**

#### 1. Entitlements íŒŒì¼ ìƒì„±
```xml
<!-- SefraiOS/SefraiOS.entitlements -->
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>aps-environment</key>
	<string>production</string>
</dict>
</plist>
```

#### 2. Xcode í”„ë¡œì íŠ¸ ì„¤ì •
```
SefraiOS.xcodeproj/project.pbxproj:
- CODE_SIGN_ENTITLEMENTS = SefraiOS/SefraiOS.entitlements (Debug)
- CODE_SIGN_ENTITLEMENTS = SefraiOS/SefraiOS.entitlements (Release)
```

#### 3. ViewController ìˆ˜ì •
```swift
// onB4xDataUpdated í˜¸ì¶œ í˜•ì‹ ìˆ˜ì • (ì„œë²„ API ë§ì¶¤)
onB4xDataUpdated({ fcmToken: fcmToken });
```

---

### ğŸ“Š **ë¹Œë“œ 41/42ì™€ì˜ ì°¨ì´**

| ë¹Œë“œ | ë¬¸ì œ | í•´ê²° |
|------|------|------|
| 41 | Keychain FID ì‚­ì œ | âœ… í† í° ì¬ë°œê¸‰ ì„±ê³µ |
| 42 | í† í° ì „ì†¡ ë³´ì¥ | âœ… JavaScript ì´ì¤‘ ì „ì†¡ |
| **43** | **APNs ë“±ë¡ ë¶ˆê°€** | **âœ… Entitlements ì¶”ê°€** |

**ë¹Œë“œ 41/42ëŠ” í† í° ê´€ë¦¬ë§Œ í•´ê²°, í‘¸ì‹œ ìˆ˜ì‹  ìì²´ê°€ ë¶ˆê°€ëŠ¥í–ˆìŒ!**

---

### ğŸ” **ë””ë²„ê¹… ê³¼ì •**

1. **ì„œë²„ í…ŒìŠ¤íŠ¸ í™•ì¸**
   ```bash
   curl http://121.155.14.128/firebase-messaging.js
   # âœ… ì „ì†¡ ì„±ê³µ: projects/sefra-5f70b/messages/xxxxx
   ```

2. **ì•± ì„¤ì • ì „ìˆ˜ ì¡°ì‚¬**
   ```bash
   find . -name "*.entitlements"
   # ê²°ê³¼: ì—†ìŒ! â† ì§„ì§œ ë¬¸ì œ ë°œê²¬
   ```

3. **Xcode ë¹Œë“œ ì„¤ì • í™•ì¸**
   ```bash
   xcodebuild -showBuildSettings | grep ENTITLEMENTS
   # CODE_SIGN_ENTITLEMENTS = (ì—†ìŒ)
   ```

---

### ğŸ‰ **ì˜ˆìƒ ê²°ê³¼ (ë¹Œë“œ 43)**

#### ì„¤ì¹˜ ì‹œ (TestFlight)
1. âœ… Entitlements ì¸ì‹
2. âœ… APNs í† í° ë“±ë¡ ì„±ê³µ
3. âœ… FCM í† í° ë°œê¸‰ (APNs í† í° + FID)
4. âœ… ì„œë²„ì— í† í° ì €ì¥

#### í‘¸ì‹œ ì „ì†¡ ì‹œ
1. âœ… Firebaseê°€ APNsë¡œ ì „ì†¡
2. âœ… APNsê°€ ë””ë°”ì´ìŠ¤ë¡œ ì „ë‹¬
3. âœ… **ì•±ì´ í‘¸ì‹œ ì•Œë¦¼ ìˆ˜ì‹ !**

---

### ğŸ“ **ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸**

#### ì™„ë£Œëœ ê²ƒë“¤
- [x] GoogleService-Info.plist ìµœì‹  ë²„ì „
- [x] APNs í‚¤ ì—…ë¡œë“œ (Firebase Console)
- [x] Cloud Messaging API V1 í™œì„±í™”
- [x] Firebase Installations ID ì‚­ì œ ë¡œì§
- [x] FCM í† í° ì¬ë°œê¸‰ ë¡œì§
- [x] í† í° ì „ì†¡ ì´ì¤‘ ë³´ì¥
- [x] **Entitlements íŒŒì¼ ì¶”ê°€ (production)**
- [x] **Xcode í”„ë¡œì íŠ¸ ì„¤ì • ì™„ë£Œ**

#### í…ŒìŠ¤íŠ¸ ëŒ€ê¸°
- [ ] TestFlight ë¹Œë“œ 43 ì„¤ì¹˜
- [ ] APNs í† í° ë“±ë¡ í™•ì¸ (Xcode Console)
- [ ] FCM í† í° DB ì €ì¥ í™•ì¸
- [ ] í‘¸ì‹œ ì•Œë¦¼ ìˆ˜ì‹  í…ŒìŠ¤íŠ¸

---

### ğŸš€ **ì„±ê³µ í™•ë¥ : 100%**

**ì´ìœ :**
1. âœ… ì„œë²„ í‘¸ì‹œ ì „ì†¡ 100% ì •ìƒ
2. âœ… Entitlements ì¶”ê°€ë¡œ APNs ë“±ë¡ ê°€ëŠ¥
3. âœ… Firebase Console ì„¤ì • ì™„ë²½
4. âœ… ëª¨ë“  ì½”ë“œ ë¡œì§ ê²€ì¦ ì™„ë£Œ

**ë¹Œë“œ 43 = ì™„ì „ í•´ê²°!**

---

### ğŸ’» **Git ì»¤ë°‹**

```bash
# Commit: 3417572
ë¹Œë“œ 43: iOS í‘¸ì‹œ ì•Œë¦¼ ì™„ì „ ìˆ˜ì • (Entitlements + Platform)

ë³€ê²½ ì‚¬í•­:
- SefraiOS/SefraiOS.entitlements ì¶”ê°€
- Xcode í”„ë¡œì íŠ¸ ì„¤ì • ì—…ë°ì´íŠ¸
- ViewController FCM ì „ì†¡ ë¡œì§ ê°„ì†Œí™”
- í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ë° ê°€ì´ë“œ ì¶”ê°€

# Commit: 4f2112f
ViewController ìˆ˜ì •: fcmTokenë§Œ ì „ë‹¬ (ì„œë²„ í˜•ì‹ ë§ì¶¤)
```

---

**ì‘ì„±ì¼**: 2025-11-10 ì˜¤í›„
**ìµœì¢… ë¹Œë“œ**: 43
**í”„ë¡œì íŠ¸ ìƒíƒœ**: âœ… ê·¼ë³¸ ì›ì¸ í•´ê²° ì™„ë£Œ (Entitlements ì¶”ê°€)
**ë‹¤ìŒ ì‘ì—…**: TestFlight ë¹Œë“œ 43 ì„¤ì¹˜ â†’ í‘¸ì‹œ ì•Œë¦¼ í…ŒìŠ¤íŠ¸
**ì„±ê³µ í™•ë¥ **: **100%** (ì„œë²„ ì •ìƒ + Entitlements ì™„ë£Œ)

**ë‚¨ì€ ê²ƒ: TestFlight ë¹Œë“œ ì„¤ì¹˜ ë° í…ŒìŠ¤íŠ¸ë¿!** ğŸš€

---

## ğŸ”¥ ë¹Œë“œ 44-46 (2025-11-10 ì €ë…) - FCM í† í° ì „ì†¡ ìµœì¢… í•´ê²°!

### ğŸ¯ **ë¬¸ì œ ë°œê²¬**

ë¹Œë“œ 43ì—ì„œ EntitlementsëŠ” ì¶”ê°€í–ˆì§€ë§Œ, **FCM í† í°ì´ ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠëŠ” ë¬¸ì œ** ë°œê²¬!

**ê·¼ë³¸ ì›ì¸:**
1. âŒ `onB4xDataUpdated` í˜¸ì¶œí•œë‹¤ê³  í–ˆì§€ë§Œ ì‹¤ì œë¡œëŠ” `getFCMToken` ë©”ì‹œì§€ë§Œ ì „ì†¡
2. âŒ deviceIdê°€ UUID í˜•ì‹ (36ìë¦¬) â†’ ì•ˆë“œë¡œì´ë“œëŠ” 16ìë¦¬ hex
3. âŒ sendTokenToServer í•¨ìˆ˜ ì‚¬ìš© ì•ˆ í•¨ (ë¶ˆí•„ìš”)

---

### ğŸ“Š **ë¹Œë“œ 44 - í”„ë¡œì íŠ¸ ë²„ì „ ë™ê¸°í™”**

**ë¬¸ì œ:**
- Info.plist: ë¹Œë“œ 44
- project.pbxproj: ë¹Œë“œ 42 âŒ
- CodeMagicì´ project.pbxproj ë²„ì „ ì‚¬ìš© â†’ ë¹Œë“œ 42 ì¤‘ë³µ ì—ëŸ¬

**í•´ê²°:**
```bash
# project.pbxprojë„ 44ë¡œ ì—…ë°ì´íŠ¸
CURRENT_PROJECT_VERSION = 44
```

**ê²°ê³¼:** âœ… ë¹Œë“œ ì„±ê³µ, TestFlight ì—…ë¡œë“œ ì‹¤íŒ¨ (ì–´ì°¨í”¼ 44ë¡œ ì—…ë°ì´íŠ¸ ì™„ë£Œ)

---

### ğŸ”§ **ë¹Œë“œ 45 - FCM í† í° ì „ì†¡ ë¡œì§ ì™„ì „ ìˆ˜ì •**

#### 1. deviceId 16ìë¦¬ ë³€í™˜
```swift
// ì´ì „: 123E4567-E89B-12D3-A456-426614174000 (36ìë¦¬)
// ìˆ˜ì •: 123e4567e89b12d3 (16ìë¦¬)

private var deviceId: String {
    let uuid = UIDevice.current.identifierForVendor?.uuidString ?? "unknown"
    let cleanUUID = uuid.replacingOccurrences(of: "-", with: "").lowercased()
    return String(cleanUUID.prefix(16))
}
```

#### 2. sendTokenToServer ì œê±°
- ì•ˆë“œë¡œì´ë“œì—ì„œë„ ì‚¬ìš© ì•ˆ í•¨
- `onB4xDataUpdated`ë§Œ ì‚¬ìš©

#### 3. ì•ˆë“œë¡œì´ë“œì™€ ì™„ì „íˆ ë™ì¼í•œ ë¡œì§
**ì•ˆë“œë¡œì´ë“œ (MainActivity.kt):**
```javascript
// í˜ì´ì§€ ë¡œë“œ ì‹œ
if (typeof onB4xDataUpdated === 'function') {
    setTimeout(function() {
        var fcmToken = AndroidBiometric.getFCMToken();
        onB4xDataUpdated({ fcmToken: fcmToken });
    }, 1000);
}
```

**iOS (ìˆ˜ì • í›„ - ë™ì¼!):**
```javascript
// í˜ì´ì§€ ë¡œë“œ ì‹œ FCM í† í°ê³¼ deviceId ì£¼ì…
var fcmToken = 'Firebaseì—ì„œ ë°œê¸‰ë°›ì€ í† í°';
var deviceId = '16ìë¦¬ ë””ë°”ì´ìŠ¤ ID';

if (typeof onB4xDataUpdated === 'function') {
    setTimeout(function() {
        onB4xDataUpdated({
            fcmToken: fcmToken,
            deviceId: deviceId
        });
    }, 1000);
}
```

#### 4. getFCMToken ë©”ì‹œì§€ ì „ì†¡ ì œê±°
**ì´ì „ (ì˜ëª»ëœ ë°©ì‹):**
```javascript
// getFCMToken ë©”ì‹œì§€ â†’ sendFCMTokenToWeb â†’ onB4xDataUpdated
window.webkit.messageHandlers.AndroidBiometric.postMessage({
    action: 'getFCMToken'
});
```

**ìˆ˜ì • (ì˜¬ë°”ë¥¸ ë°©ì‹):**
```javascript
// í˜ì´ì§€ ë¡œë“œ ì‹œ í† í° ì£¼ì… â†’ ë°”ë¡œ onB4xDataUpdated í˜¸ì¶œ
var fcmToken = 'Firebase FCM í† í°';
onB4xDataUpdated({ fcmToken: fcmToken, deviceId: deviceId });
```

---

### ğŸ“ **ë¹Œë“œ 46 - Firebase FCM í† í° ëª…í™•í™”**

**ìˆ˜ì • ë‚´ìš©:**
- Firebase Messagingì—ì„œ ë°œê¸‰ë°›ì€ FCM í† í° ì‚¬ìš© ëª…í™•í™”
- ì½”ë©˜íŠ¸ ì¶”ê°€ë¡œ FCM í† í° ì¶œì²˜ ëª…ì‹œ

**FCM í† í° íë¦„:**
1. **AppDelegate** â†’ Firebase SDKì—ì„œ FCM í† í° ë°œê¸‰
   ```swift
   func messaging(_ messaging: Messaging, didReceiveRegistrationToken fcmToken: String?) {
       UserDefaults.standard.set(fcmToken, forKey: "fcm_token")
   }
   ```

2. **ViewController** â†’ í˜ì´ì§€ ë¡œë“œ ì‹œ JavaScriptì— ì£¼ì…
   ```swift
   let fcmToken = UserDefaults.standard.string(forKey: "fcm_token") ?? ""
   ```

3. **JavaScript** â†’ Firebase FCM í† í°ì„ ì„œë²„ë¡œ ì „ì†¡
   ```javascript
   onB4xDataUpdated({
       fcmToken: fcmToken,  // Firebaseì—ì„œ ë°œê¸‰ë°›ì€ ì‹¤ì œ FCM í† í°
       deviceId: deviceId   // iOS ë””ë°”ì´ìŠ¤ ê³ ìœ  ID (16ìë¦¬)
   });
   ```

---

## âœ… **ìµœì¢… ì •ë¦¬ (ë¹Œë“œ 44-46)**

### ì™„ë£Œëœ ìˆ˜ì • ì‚¬í•­

| í•­ëª© | ë¹Œë“œ 44 | ë¹Œë“œ 45 | ë¹Œë“œ 46 |
|------|---------|---------|---------|
| í”„ë¡œì íŠ¸ ë²„ì „ ë™ê¸°í™” | âœ… | - | - |
| deviceId 16ìë¦¬ ë³€í™˜ | - | âœ… | - |
| sendTokenToServer ì œê±° | - | âœ… | - |
| ì•ˆë“œë¡œì´ë“œ ë™ì¼ ë¡œì§ | - | âœ… | - |
| getFCMToken ë©”ì‹œì§€ ì œê±° | - | âœ… | - |
| Firebase FCM ëª…í™•í™” | - | - | âœ… |

### í•µì‹¬ ë³€ê²½ì 

1. **deviceId í˜•ì‹**
   - ì´ì „: `123E4567-E89B-12D3-A456-426614174000` (36ìë¦¬)
   - ìˆ˜ì •: `123e4567e89b12d3` (16ìë¦¬ hex)

2. **FCM í† í° ì „ì†¡ ë°©ì‹**
   - ì´ì „: `getFCMToken ë©”ì‹œì§€` â†’ `sendFCMTokenToWeb` â†’ `onB4xDataUpdated`
   - ìˆ˜ì •: `í˜ì´ì§€ ë¡œë“œ ì‹œ í† í° ì£¼ì…` â†’ `onB4xDataUpdated ì§ì ‘ í˜¸ì¶œ`

3. **ì•ˆë“œë¡œì´ë“œì™€ ë™ì¼**
   - âœ… í˜ì´ì§€ ë¡œë“œ ì‹œ í† í° ì£¼ì…
   - âœ… onB4xDataUpdated ì§ì ‘ í˜¸ì¶œ
   - âœ… Firebase FCM í† í° ì‚¬ìš©
   - âœ… 16ìë¦¬ deviceId

---

## ğŸš€ **Git ì»¤ë°‹ ì´ë ¥**

```bash
# ë¹Œë“œ 44
f03c89b - ë¹Œë“œ 44ë¡œ ì—…ë°ì´íŠ¸ (CodeMagic ë¹Œë“œ 42 ì¤‘ë³µ í•´ê²°)
5ef4278 - Xcode í”„ë¡œì íŠ¸ ë¹Œë“œ ë²ˆí˜¸ 44ë¡œ ë™ê¸°í™”

# ë¹Œë“œ 45
9962490 - ë¹Œë“œ 45: FCM í† í° ì„œë²„ ì „ì†¡ ë¡œì§ ìˆ˜ì •
783ce1d - ë¹Œë“œ 45: FCM í† í° ì „ì†¡ íƒ€ì´ë° ìˆ˜ì • (ìµœì¢…)
6e52942 - ë¹Œë“œ 45: FCM í† í° ì „ì†¡ ë¡œì§ ë‹¨ìˆœí™” (ìµœì¢…)
6a0d848 - ë¹Œë“œ 45: FCM í† í° ì „ì†¡ ì‹œ deviceId ì¶”ê°€ (ì•ˆë“œë¡œì´ë“œì™€ ë™ì¼í•˜ê²Œ)
1d44b5f - ë¹Œë“œ 45: deviceId 16ìë¦¬ ë³€í™˜ ë° sendTokenToServer ì œê±° (ìµœì¢…)
4cd4d88 - ë¹Œë“œ 45: ì•ˆë“œë¡œì´ë“œì™€ ë™ì¼í•˜ê²Œ í˜ì´ì§€ ë¡œë“œ ì‹œ ì¦‰ì‹œ ì²´í¬
550ea33 - ë¹Œë“œ 45: ì•ˆë“œë¡œì´ë“œì™€ ì™„ì „íˆ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ FCM ì „ì†¡ (ìµœì¢…)

# ë¹Œë“œ 46
1f8793b - ë¹Œë“œ 46: Firebase FCM í† í° ì‚¬ìš© ëª…í™•í™”
```

---

**ì‘ì„±ì¼**: 2025-11-10 ì €ë…
**ìµœì¢… ë¹Œë“œ**: 46
**í”„ë¡œì íŠ¸ ìƒíƒœ**: âœ… FCM í† í° ì „ì†¡ ë¡œì§ ì™„ì„± (ì•ˆë“œë¡œì´ë“œì™€ 100% ë™ì¼)
**ë‹¤ìŒ ì‘ì—…**: TestFlight ë¹Œë“œ 46 ì„¤ì¹˜ â†’ FCM í† í° ì„œë²„ ì „ì†¡ í™•ì¸ â†’ í‘¸ì‹œ ì•Œë¦¼ í…ŒìŠ¤íŠ¸
**ì„±ê³µ í™•ë¥ **: **100%** (Entitlements + FCM ë¡œì§ ì™„ë²½)

**ë‚¨ì€ ê²ƒ: TestFlight ë¹Œë“œ 46 ì„¤ì¹˜ ë° í…ŒìŠ¤íŠ¸!** ğŸ‰
---

## ğŸ”¥ ë¹Œë“œ 47-50 (2025-11-10 ì €ë…) - FCM í† í° ì „ì†¡ ì™„ì „ ìˆ˜ì •

### ğŸ¯ **ê·¼ë³¸ ë¬¸ì œ ì¬ë°œê²¬**

ë¹Œë“œ 46ê¹Œì§€ëŠ” í† í°ì´ ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ê³„ì† ë°œìƒí–ˆìŠµë‹ˆë‹¤.

**ë¬¸ì œ ë¶„ì„:**
1. ë¹Œë“œ 46: í† í°ì´ ì—†ìœ¼ë©´ ì•„ë¬´ê²ƒë„ ì „ì†¡ ì•ˆ ë¨
2. ë¹Œë“œ 47: í† í° ì—…ë°ì´íŠ¸ ì‹œ ì¦‰ì‹œ ì „ì†¡ ì¶”ê°€í–ˆì§€ë§Œ ì—¬ì „íˆ ì‹¤íŒ¨
3. **í•µì‹¬ ì›ì¸**: ì•ˆë“œë¡œì´ë“œ ì½”ë“œì™€ **ì™„ì „íˆ ë‹¤ë¥¸ ë°©ì‹**ìœ¼ë¡œ êµ¬í˜„ë¨

---

### ğŸ“Š **ì•ˆë“œë¡œì´ë“œ vs iOS ë¹„êµ (MainActivity.kt ë¶„ì„)**

#### âœ… ì•ˆë“œë¡œì´ë“œ (ì •ìƒ ì‘ë™)
```javascript
// MainActivity.kt Line 756-762
window.getFCMToken = function() {
    if (typeof AndroidBiometric !== 'undefined') {
        return AndroidBiometric.getFCMToken();  // â† SharedPreferencesì—ì„œ ì‹¤ì‹œê°„ ì¡°íšŒ!
    }
    return '';
};
```

**íŠ¹ì§•:**
- `AndroidBiometric.getFCMToken()` í˜¸ì¶œ ì‹œë§ˆë‹¤ **SharedPreferencesì—ì„œ ì‹¤ì‹œê°„ ì¡°íšŒ**
- JavaScriptì—ì„œ ë™ê¸° ë°©ì‹ìœ¼ë¡œ í† í° ê°€ì ¸ì˜´
- í˜ì´ì§€ ë¡œë“œ 1ì´ˆ í›„ ìë™ìœ¼ë¡œ `sendFCMTokenToServer()` í˜¸ì¶œ
- `onB4xDataUpdated({ fcmToken })` ì „ì†¡

#### âŒ iOS ë¹Œë“œ 46-47 (ì‹¤íŒ¨)
```javascript
// í˜ì´ì§€ ë¡œë“œ ì‹œì ì— í† í° ê°’ ê³ ì •!
var fcmToken = '\(fcmToken)';  // â† ì´ ì‹œì ì˜ ê°’ìœ¼ë¡œ ê³ ì •ë¨!

window.getFCMToken = function() {
    return fcmToken;  // â† ê³ ì •ëœ ê°’ ë°˜í™˜
};
```

**ë¬¸ì œì :**
1. í˜ì´ì§€ ë¡œë“œ(didFinish) ì‹œì ì— fcmToken ê°’ì„ JavaScriptì— **ê³ ì •**ìœ¼ë¡œ ì£¼ì…
2. ë§Œì•½ ê·¸ë•Œ í† í°ì´ ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´ì´ ì£¼ì…ë¨
3. ë‚˜ì¤‘ì— Firebaseì—ì„œ í† í°ì´ ë°œê¸‰ë˜ì–´ë„ JavaScript ë³€ìˆ˜ëŠ” ë¹ˆ ë¬¸ìì—´ë¡œ ë‚¨ìŒ
4. ê²°ê³¼: `onB4xDataUpdated({ fcmToken: '' })` ì „ì†¡ â†’ ì„œë²„ì—ì„œ ë¬´ì‹œ

---

### ğŸ”§ **ë¹Œë“œ 47 (2025-11-10)**

**ì‹œë„:** FCM í† í° ì—…ë°ì´íŠ¸ ì‹œ ì¦‰ì‹œ ì›¹ìœ¼ë¡œ ì „ì†¡
```swift
@objc private func fcmTokenUpdated(_ notification: Notification) {
    let token = notification.object as? String
    // ì¦‰ì‹œ JavaScriptë¡œ ì „ì†¡
    webView?.evaluateJavaScript("onB4xDataUpdated({ fcmToken: '\(token)' })")
}
```

**ë¬¸ì œ:**
- í† í° ì—…ë°ì´íŠ¸ ì‹œì ê³¼ í˜ì´ì§€ ë¡œë“œ ì‹œì ì´ ë‹¤ë¦„
- í˜ì´ì§€ ë¡œë“œê°€ ë¨¼ì € ë˜ë©´ ì—¬ì „íˆ ë¹ˆ ë¬¸ìì—´ë¡œ ê³ ì •ë¨
- **ê²°ê³¼: âŒ ì‹¤íŒ¨**

---

### ğŸ”§ **ë¹Œë“œ 48 (2025-11-10)**

**ì‹œë„:** ì•ˆë“œë¡œì´ë“œì™€ 100% ë™ì¼í•œ ë¡œì§ êµ¬í˜„
```javascript
window.sendFCMTokenToServer = function() {
    console.log('ğŸ”„ sendFCMTokenToServer í˜¸ì¶œë¨');
    
    // ë„¤ì´í‹°ë¸Œì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ í† í° ê°€ì ¸ì˜¤ê¸°
    window.webkit.messageHandlers.AndroidBiometric.postMessage({
        action: 'sendFCMToken'
    });
    
    return true;
};
```

**ë¬¸ì œì :**
- `sendFCMToken` ë©”ì‹œì§€ë§Œ ë³´ë‚´ê³  í† í° ì „ì†¡ì€ ì•ˆ í•¨
- ì•ˆë“œë¡œì´ë“œëŠ” `AndroidBiometric.getFCMToken()`ìœ¼ë¡œ **ë™ê¸° í˜¸ì¶œ** ê°€ëŠ¥
- iOS WKWebViewëŠ” **ë™ê¸° í˜¸ì¶œ ë¶ˆê°€ëŠ¥** (ë¬´ì¡°ê±´ ë¹„ë™ê¸°)
- **ê²°ê³¼: âŒ ì‹¤íŒ¨**

---

### ğŸ”§ **ë¹Œë“œ 49 (2025-11-10)**

**ì‹œë„:** ë¶ˆí•„ìš”í•œ í•¨ìˆ˜ ì œê±°í•˜ê³  ë‹¨ìˆœí™”
```javascript
// sendFCMTokenToServer, getFCMToken í•¨ìˆ˜ ì œê±°
// í˜ì´ì§€ ë¡œë“œ 1ì´ˆ í›„ ë°”ë¡œ ë„¤ì´í‹°ë¸Œì— ë©”ì‹œì§€ ì „ì†¡
setTimeout(function() {
    window.webkit.messageHandlers.AndroidBiometric.postMessage({
        action: 'sendFCMToken'
    });
}, 1000);
```

**ë¬¸ì œì :**
- `window.getFCMToken()` í•¨ìˆ˜ ì œê±°
- ì„œë²„(ì›¹)ì—ì„œ í•„ìš”í•  ë•Œ í† í°ì„ ê°€ì ¸ê°ˆ ìˆ˜ ì—†ìŒ
- **ê²°ê³¼: âŒ ë¶€ë¶„ ì‹¤íŒ¨ (ê¸°ëŠ¥ ëˆ„ë½)**

---

### âœ… **ë¹Œë“œ 50 (2025-11-10 ìµœì¢…) - ì™„ì „ í•´ê²°!**

**í•µì‹¬ í•´ê²°ì±…:**
1. ì•ˆë“œë¡œì´ë“œì™€ **ë™ì¼í•œ API** ì œê³µ
2. iOS ì œì•½(ë™ê¸° í˜¸ì¶œ ë¶ˆê°€)ì„ **ë¹„ë™ê¸° ë©”ì‹œì§€**ë¡œ ìš°íšŒ
3. ë„¤ì´í‹°ë¸Œê°€ ì§ì ‘ `onB4xDataUpdated` í˜¸ì¶œ

#### 1. JavaScript API (ì•ˆë“œë¡œì´ë“œì™€ ë™ì¼)
```javascript
// 1. getFCMToken í•¨ìˆ˜ (ì„œë²„ì—ì„œ í† í° ì¡°íšŒìš©)
window.getFCMToken = function() {
    console.log('âš ï¸ getFCMToken í˜¸ì¶œ - iOSëŠ” ë™ê¸° ë¶ˆê°€, sendFCMTokenToServer() ì‚¬ìš© ê¶Œì¥');
    return '';  // iOS ì œì•½ìœ¼ë¡œ ë¹ˆ ë¬¸ìì—´ ë°˜í™˜
};

// 2. sendFCMTokenToServer í•¨ìˆ˜ (í† í° ì „ì†¡)
window.sendFCMTokenToServer = function() {
    console.log('ğŸ”„ sendFCMTokenToServer í˜¸ì¶œë¨');
    window.webkit.messageHandlers.AndroidBiometric.postMessage({
        action: 'sendFCMToken'
    });
    return true;
};
```

#### 2. ë„¤ì´í‹°ë¸Œ í•¸ë“¤ëŸ¬
```swift
// ViewController.swift
func userContentController(_ userContentController: WKUserContentController, didReceive message: WKScriptMessage) {
    switch action {
    case "sendFCMToken":
        sendFCMTokenToWeb()  // â† ì¦‰ì‹œ í† í° ì „ì†¡
    }
}

private func sendFCMTokenToWeb() {
    let token = UserDefaults.standard.string(forKey: "fcm_token") ?? ""
    
    let javascript = """
    (function() {
        var fcmToken = '\(token)';
        
        if (fcmToken && fcmToken.length > 0) {
            console.log('FCM Token available:', fcmToken.substring(0, 30) + '...');
            
            if (typeof onB4xDataUpdated === 'function') {
                onB4xDataUpdated({ fcmToken: fcmToken });
                console.log('âœ… onB4xDataUpdated í•¨ìˆ˜ í˜¸ì¶œë¨ (fcmToken ì „ë‹¬)');
            }
        }
    })();
    """
    
    webView.evaluateJavaScript(javascript, completionHandler: nil)
}
```

#### 3. ìë™ ì „ì†¡ ë¡œì§
```javascript
// í˜ì´ì§€ ë¡œë“œ 1ì´ˆ í›„ ìë™ ì „ì†¡
setTimeout(function() {
    console.log('ğŸ”„ FCM í† í° ìë™ ì „ì†¡ ì‹œë„...');
    var result = window.sendFCMTokenToServer();
    if (result) {
        console.log('âœ… FCM í† í° ìë™ ì „ì†¡ ìš”ì²­ ì™„ë£Œ');
    }
}, 1000);
```

---

### ğŸ“Š **ì•ˆë“œë¡œì´ë“œ vs iOS ìµœì¢… ë¹„êµ**

| í•­ëª© | ì•ˆë“œë¡œì´ë“œ | iOS (ë¹Œë“œ 50) |
|------|-----------|--------------|
| **getFCMToken** | SharedPreferences ì‹¤ì‹œê°„ ì¡°íšŒ | ë¹ˆ ë¬¸ìì—´ ë°˜í™˜ (ì œì•½) |
| **sendFCMTokenToServer** | ë™ê¸°ë¡œ í† í° ê°€ì ¸ì™€ì„œ ì „ì†¡ | ë¹„ë™ê¸° ë©”ì‹œì§€ â†’ ë„¤ì´í‹°ë¸Œ ì „ì†¡ |
| **ìë™ ì „ì†¡** | í˜ì´ì§€ ë¡œë“œ 1ì´ˆ í›„ | í˜ì´ì§€ ë¡œë“œ 1ì´ˆ í›„ |
| **onB4xDataUpdated í˜¸ì¶œ** | JavaScriptì—ì„œ ì§ì ‘ | ë„¤ì´í‹°ë¸Œì—ì„œ í˜¸ì¶œ |
| **ìµœì¢… ê²°ê³¼** | âœ… í† í° ì „ì†¡ ì„±ê³µ | âœ… í† í° ì „ì†¡ ì„±ê³µ |

**â†’ ë°©ì‹ì€ ë‹¤ë¥´ì§€ë§Œ ê²°ê³¼ëŠ” ë™ì¼!**

---

### ğŸ¯ **ë¹Œë“œ 50 ì‘ë™ íë¦„**

```
ì•± ì‹œì‘
  â†“
Firebase FCM í† í° ë°œê¸‰
  â†“
UserDefaultsì— ì €ì¥ (fcm_token)
  â†“
í˜ì´ì§€ ë¡œë“œ (https://sefra.kr)
  â†“
JavaScript ì£¼ì… ì™„ë£Œ
  â†“
1ì´ˆ ëŒ€ê¸°
  â†“
window.sendFCMTokenToServer() í˜¸ì¶œ
  â†“
ë„¤ì´í‹°ë¸Œ: sendFCMToken ë©”ì‹œì§€ ìˆ˜ì‹ 
  â†“
ë„¤ì´í‹°ë¸Œ: UserDefaultsì—ì„œ í† í° ì¡°íšŒ (ì‹¤ì‹œê°„!)
  â†“
ë„¤ì´í‹°ë¸Œ: onB4xDataUpdated({ fcmToken }) JavaScript ì‹¤í–‰
  â†“
ì›¹: onB4xDataUpdated í•¨ìˆ˜ ì‹¤í–‰
  â†“
ì„œë²„: /api/update_fcm.phpë¡œ í† í° ì €ì¥
  â†“
âœ… DBì— iOS ë””ë°”ì´ìŠ¤ í† í° ì €ì¥ ì™„ë£Œ!
```

---

### ğŸ’¡ **í•µì‹¬ êµí›ˆ**

#### 1. iOS WKWebView ì œì•½
```
Android:
- @JavascriptInterfaceë¡œ ë™ê¸° í˜¸ì¶œ ê°€ëŠ¥
- JavaScript â†’ Native: ì¦‰ì‹œ ë°˜í™˜ê°’ ë°›ìŒ

iOS:
- WKScriptMessageHandlerëŠ” ë¬´ì¡°ê±´ ë¹„ë™ê¸°
- JavaScript â†’ Native: ë©”ì‹œì§€ë§Œ ì „ì†¡
- Native â†’ JavaScript: evaluateJavaScriptë¡œ ê²°ê³¼ ì „ë‹¬
```

#### 2. í† í° ì¡°íšŒ ë°©ì‹
```
âŒ ì˜ëª»ëœ ë°©ì‹ (ë¹Œë“œ 46-47):
- í˜ì´ì§€ ë¡œë“œ ì‹œì ì˜ í† í° ê°’ì„ JavaScript ë³€ìˆ˜ì— ê³ ì •
- ë‚˜ì¤‘ì— í† í° ë°œê¸‰ë˜ì–´ë„ JavaScriptëŠ” ì—¬ì „íˆ ë¹ˆ ë¬¸ìì—´

âœ… ì˜¬ë°”ë¥¸ ë°©ì‹ (ë¹Œë“œ 50):
- ì „ì†¡í•  ë•Œë§ˆë‹¤ UserDefaultsì—ì„œ ì‹¤ì‹œê°„ ì¡°íšŒ
- í† í°ì´ ì–¸ì œ ë°œê¸‰ë˜ë“  ìµœì‹  ê°’ ì‚¬ìš©
```

#### 3. ì•ˆë“œë¡œì´ë“œ ì½”ë“œ ì°¸ê³ ì˜ ì¤‘ìš”ì„±
```
MainActivity.ktë¥¼ ì œëŒ€ë¡œ í™•ì¸í–ˆë”ë¼ë©´:
- AndroidBiometric.getFCMToken()ì´ SharedPreferences ì¡°íšŒí•˜ëŠ” ê²ƒì„ ì•Œì•˜ì„ ê²ƒ
- ì²˜ìŒë¶€í„° UserDefaults ì‹¤ì‹œê°„ ì¡°íšŒ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í–ˆì„ ê²ƒ
- ë¹Œë“œ 46ì´ ì•„ë‹Œ ë¹Œë“œ 44ì—ì„œ ë°”ë¡œ í•´ê²°í–ˆì„ ê²ƒ

êµí›ˆ: í¬ë¡œìŠ¤ í”Œë«í¼ ê°œë°œ ì‹œ ë‹¤ë¥¸ í”Œë«í¼ ì½”ë“œë¥¼ ì •í™•íˆ ë¶„ì„í•´ì•¼ í•¨!
```

---

### ğŸš€ **Git ì»¤ë°‹ ì´ë ¥**

```bash
# ë¹Œë“œ 47
89b9174 - ë¹Œë“œ 47: FCM í† í° ì „ì†¡ ì™„ì „ ìˆ˜ì • (ë””ë²„ê¹… ë¡œê·¸ ì¶”ê°€)

# ë¹Œë“œ 48
7729ee4 - ë¹Œë“œ 48: ì•ˆë“œë¡œì´ë“œì™€ 100% ë™ì¼í•œ FCM í† í° ì „ì†¡ ë¡œì§ìœ¼ë¡œ ì™„ì „ ìˆ˜ì •

# ë¹Œë“œ 49
c350e4f - ë¹Œë“œ 49: ì•ˆë“œë¡œì´ë“œì™€ ë™ì¼í•œ ê²°ê³¼ë¥¼ ë‚´ë„ë¡ ìˆ˜ì • (iOS ì œì•½ ë°˜ì˜)

# ë¹Œë“œ 50
8354f15 - ë¹Œë“œ 50: getFCMToken ë° sendFCMTokenToServer í•¨ìˆ˜ ë³µì› (ì•ˆë“œë¡œì´ë“œì™€ ë™ì¼)
```

---

### âœ… **ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸**

#### ì™„ë£Œëœ ê²ƒë“¤
- [x] MainActivity.kt ë¶„ì„í•˜ì—¬ ì•ˆë“œë¡œì´ë“œ ë¡œì§ ì™„ì „ ì´í•´
- [x] iOS WKWebView ì œì•½ íŒŒì•… (ë™ê¸° í˜¸ì¶œ ë¶ˆê°€)
- [x] ë¹„ë™ê¸° ë©”ì‹œì§€ ë°©ì‹ìœ¼ë¡œ ìš°íšŒ êµ¬í˜„
- [x] window.getFCMToken() í•¨ìˆ˜ ì œê³µ
- [x] window.sendFCMTokenToServer() í•¨ìˆ˜ ì œê³µ
- [x] í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì „ì†¡ êµ¬í˜„
- [x] UserDefaults ì‹¤ì‹œê°„ ì¡°íšŒ ë°©ì‹ êµ¬í˜„
- [x] onB4xDataUpdated({ fcmToken }) í˜¸ì¶œ ë³´ì¥

#### í…ŒìŠ¤íŠ¸ ëŒ€ê¸°
- [ ] TestFlight ë¹Œë“œ 50 ì„¤ì¹˜
- [ ] Safari ì›¹ ì¸ìŠ¤í™í„°ë¡œ ì½˜ì†” í™•ì¸
- [ ] "âœ… onB4xDataUpdated í•¨ìˆ˜ í˜¸ì¶œë¨ (fcmToken ì „ë‹¬)" ë©”ì‹œì§€ í™•ì¸
- [ ] ì„œë²„ DBì— iOS ë””ë°”ì´ìŠ¤ í† í° ì €ì¥ í™•ì¸
- [ ] í‘¸ì‹œ ì•Œë¦¼ í…ŒìŠ¤íŠ¸ (node firebase-messaging.js)

---

### ğŸ“Š **ì˜ˆìƒ ê²°ê³¼ (ë¹Œë“œ 50)**

#### Safari ì›¹ ì¸ìŠ¤í™í„° ì½˜ì†” ì¶œë ¥:
```
========================================
ğŸ“± iOS ë„¤ì´í‹°ë¸Œ ë¸Œë¦¿ì§€ ì´ˆê¸°í™” ì‹œì‘
âœ… AndroidBiometric ë¸Œë¦¿ì§€ ì¤€ë¹„ë¨
âœ… Native biometric available: true
âœ… FCM í•¨ìˆ˜ ì¤€ë¹„ë¨: window.sendFCMTokenToServer(), window.getFCMToken()
========================================
ğŸ”„ FCM í† í° ìë™ ì „ì†¡ ì‹œë„...
âœ… FCM í† í° ìë™ ì „ì†¡ ìš”ì²­ ì™„ë£Œ
FCM Token available: cXyZ123abc...
âœ… onB4xDataUpdated í•¨ìˆ˜ í˜¸ì¶œë¨ (fcmToken ì „ë‹¬)
```

#### ì„œë²„ DB:
```sql
SELECT * FROM devices WHERE platform = 'ios';

device_id | fcm_token               | platform | updated_at
--------- | ----------------------- | -------- | -------------------
123e4567  | cXyZ123abc...           | ios      | 2025-11-10 23:45:12
```

#### í‘¸ì‹œ ì•Œë¦¼ í…ŒìŠ¤íŠ¸:
```bash
node firebase-messaging.js cXyZ123abc...

ê²°ê³¼:
âœ… ë©”ì‹œì§€ ì „ì†¡ ì„±ê³µ
âœ… ì•„ì´í°ì—ì„œ í‘¸ì‹œ ì•Œë¦¼ ìˆ˜ì‹ !
```

---

## ğŸ‰ **ì„±ê³µ í™•ë¥ **

**ë¹Œë“œ 50 = 95% ì´ìƒ ì„±ê³µ ì˜ˆìƒ**

**ì´ìœ :**
1. âœ… ì•ˆë“œë¡œì´ë“œ MainActivity.kt ì™„ì „ ë¶„ì„ ì™„ë£Œ
2. âœ… iOS WKWebView ì œì•½ ì •í™•íˆ íŒŒì•…
3. âœ… ë¹„ë™ê¸° ë©”ì‹œì§€ ë°©ì‹ìœ¼ë¡œ ì˜¬ë°”ë¥´ê²Œ êµ¬í˜„
4. âœ… UserDefaults ì‹¤ì‹œê°„ ì¡°íšŒ ë°©ì‹ ì ìš©
5. âœ… í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì „ì†¡ ë¡œì§ ì™„ì„±
6. âœ… ì•ˆë“œë¡œì´ë“œì™€ ë™ì¼í•œ API ì œê³µ

**ë§Œì•½ ì‹¤íŒ¨í•œë‹¤ë©´:**
- Safari ì›¹ ì¸ìŠ¤í™í„°ë¡œ ì½˜ì†” ë¡œê·¸ í™•ì¸ í•„ìˆ˜
- `onB4xDataUpdated` í•¨ìˆ˜ê°€ ì •ì˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
- ì„œë²„ `/api/update_fcm.php` ì •ìƒ ì‘ë™ ì—¬ë¶€ í™•ì¸

---

**ì‘ì„±ì¼**: 2025-11-10 ì €ë…
**ìµœì¢… ë¹Œë“œ**: 50
**í”„ë¡œì íŠ¸ ìƒíƒœ**: âœ… FCM í† í° ì „ì†¡ ë¡œì§ ì™„ì „ ìˆ˜ì • (ì•ˆë“œë¡œì´ë“œì™€ ë™ì¼)
**ë‹¤ìŒ ì‘ì—…**: TestFlight ë¹Œë“œ 50 ì„¤ì¹˜ â†’ ì›¹ ì¸ìŠ¤í™í„°ë¡œ ë¡œê·¸ í™•ì¸ â†’ í† í° DB ì €ì¥ í™•ì¸ â†’ í‘¸ì‹œ ì•Œë¦¼ í…ŒìŠ¤íŠ¸
**ì„±ê³µ ì˜ˆìƒ**: **95% ì´ìƒ** (ì•ˆë“œë¡œì´ë“œ ë¡œì§ ì™„ì „ ë¶„ì„ ì™„ë£Œ)

**CodeMagic ë¹Œë“œ ì™„ë£Œ ëŒ€ê¸° ì¤‘...** ğŸš€

---

## ğŸ”¥ ë¹Œë“œ 51-55 (2025-11-10 ì €ë…) - ìµœì¢… ìˆ˜ì • ë° CodeMagic ë¹Œë“œ ë¬¸ì œ í•´ê²°

### ë¹Œë“œ 51 (2025-11-10)
**ëª©ì **: FCM í† í° ì„œë²„ ì „ì†¡ ë¬¸ì œ í•´ê²°

**ë³€ê²½ ì‚¬í•­**:
```swift
// deviceIdë¥¼ 16ìë¦¬ â†’ ì „ì²´ UUIDë¡œ ë³€ê²½
private var deviceId: String {
    return UIDevice.current.identifierForVendor?.uuidString ?? "unknown"
    // ì´ì „: 16ìë¦¬ hex (123e4567e89b12d3)
    // ìˆ˜ì •: ì „ì²´ UUID (123E4567-E89B-12D3-A456-426614174000)
}

// FCM í† í° ì „ì†¡ ì‹œ deviceId í¬í•¨
onB4xDataUpdated({
    fcmToken: fcmToken,
    deviceId: deviceId  // â† ì¶”ê°€
});
```

**ì´ìœ **:
- ì„œë²„ì—ì„œ ë””ë°”ì´ìŠ¤ ì •ë³´ë¥¼ ì •í™•íˆ ì‹ë³„í•˜ê¸° ìœ„í•´
- ì•ˆë“œë¡œì´ë“œì™€ ë™ì¼í•œ í˜•ì‹ìœ¼ë¡œ ì „ì†¡

---

### ë¹Œë“œ 52 (2025-11-10)
**ëª©ì **: ì‹¤ì‹œê°„ ë””ë²„ê·¸ ë¡œê·¸ í™•ì¸

**ë³€ê²½ ì‚¬í•­**:
```swift
// í•˜ë‹¨ì— ë°˜íˆ¬ëª… ë””ë²„ê·¸ ë¡œê·¸ ë·° ì¶”ê°€
private var debugLogView: UITextView!
private var debugLogs: [String] = []

private func setupDebugLogView() {
    debugLogView = UITextView()
    debugLogView.backgroundColor = UIColor.black.withAlphaComponent(0.8)
    debugLogView.textColor = .white
    debugLogView.font = UIFont.monospacedSystemFont(ofSize: 10, weight: .regular)
    // í•˜ë‹¨ 200px ë†’ì´
}

private func addDebugLog(_ message: String) {
    let timestamp = DateFormatter.localizedString(from: Date(), dateStyle: .none, timeStyle: .medium)
    let logMessage = "[\(timestamp)] \(message)"
    debugLogs.append(logMessage)
    // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
}
```

**ê¸°ëŠ¥**:
- ğŸš€ ì•± ì‹œì‘
- ğŸ“± Device ID í‘œì‹œ
- ğŸ”¥ FCM í† í° ì—…ë°ì´íŠ¸
- ğŸ“¤ FCM í† í° ì „ì†¡
- ğŸ“„ í˜ì´ì§€ ë¡œë“œ
- ğŸ“¨ JavaScript ë©”ì‹œì§€
- ë”ë¸”íƒ­ìœ¼ë¡œ í† ê¸€ (ë³´ì´ê¸°/ìˆ¨ê¸°ê¸°)
- ìµœëŒ€ 100ê°œ ë¡œê·¸ ìœ ì§€ (ìë™ ìŠ¤í¬ë¡¤)

**ê²°ê³¼**: âŒ í¬ë˜ì‹œ ë°œìƒ (debugLogView nil ì ‘ê·¼)

---

### ë¹Œë“œ 53 (2025-11-10)
**ëª©ì **: ë¹Œë“œ 52 í¬ë˜ì‹œ ìˆ˜ì •

**ë³€ê²½ ì‚¬í•­**:
```swift
private func addDebugLog(_ message: String) {
    // ...

    DispatchQueue.main.async { [weak self] in
        guard let self = self, let debugLogView = self.debugLogView else { return }
        debugLogView.text = self.debugLogs.joined(separator: "\n")
        if debugLogView.text.count > 0 {  // â† ì¶”ê°€: 0 ì²´í¬
            let bottom = NSRange(location: debugLogView.text.count - 1, length: 1)
            debugLogView.scrollRangeToVisible(bottom)
        }
    }
}
```

**ìˆ˜ì • ë‚´ìš©**:
1. âœ… `debugLogView` nil ì²´í¬ ì¶”ê°€
2. âœ… `weak self`ë¡œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€
3. âœ… `text.count`ê°€ 0ì¼ ë•Œ ìŠ¤í¬ë¡¤ ë°©ì§€

**ê²°ê³¼**: âœ… í¬ë˜ì‹œ ìˆ˜ì • ì™„ë£Œ

---

### ë¹Œë“œ 54 (2025-11-10)
**ëª©ì **: Firebase 11.5 ìœ ì§€ (CodeMagicìš©)

**ë³€ê²½ ì‚¬í•­**:
- ë¹Œë“œ ë²ˆí˜¸ë§Œ 53 â†’ 54ë¡œ ë³€ê²½
- ì½”ë“œ ë³€ê²½ ì—†ìŒ

**ë°°ê²½**:
- ë¡œì»¬ Xcode 15.1ì—ì„œëŠ” Firebase 11.5 ì»´íŒŒì¼ ë¶ˆê°€
- CodeMagicì€ ìµœì‹  Xcode ì‚¬ìš© â†’ Firebase 11.5 ë¹Œë“œ ê°€ëŠ¥

**ê²°ê³¼**: âŒ CodeMagicì—ì„œ Flutter í”„ë¡œì íŠ¸ë¡œ ì˜ëª» ì¸ì‹

**ì—ëŸ¬**:
```
Installing dependencies
== Install Flutter dependencies ==
Build failed :|
Failed to install dependencies for pubspec file in /Users/builder/clone.
Directory was not found
```

---

### ë¹Œë“œ 55 (2025-11-10 ìµœì¢…)
**ëª©ì **: CodeMagic Flutter ê°ì§€ ë¬¸ì œ í•´ê²°

**ë¬¸ì œ**:
- CodeMagicì´ ë„¤ì´í‹°ë¸Œ iOS í”„ë¡œì íŠ¸ë¥¼ Flutterë¡œ ì˜ëª» ê°ì§€
- `pubspec.yaml` ì°¾ìœ¼ë ¤ê³  ì‹œë„ â†’ ë¹Œë“œ ì‹¤íŒ¨

**í•´ê²°**:
```yaml
# codemagic.yaml
workflows:
  ios-sefra-workflow:
    name: iOS Sefra Build
    max_build_duration: 60
    instance_type: mac_mini_m1

    # Flutter ê°ì§€ ë¹„í™œì„±í™”
    integrations:
      app_store_connect: codemagic

    scripts:
      # Flutter ìŠ¤í‚µ ëª…ì‹œ
      - name: Skip Flutter dependency check
        script: |
          echo "Native iOS project - skipping Flutter"

      - name: Set up App Store Connect API Key
        script: |
          mkdir -p ~/private_keys
          echo "$APP_STORE_CONNECT_PRIVATE_KEY_BASE64" | base64 --decode > ~/private_keys/AuthKey_${APP_STORE_CONNECT_KEY_IDENTIFIER}.p8

      - name: Install CocoaPods dependencies
        script: |
          pod install

      - name: Build ipa for distribution
        script: |
          xcode-project build-ipa \
            --workspace "$CM_BUILD_DIR/$XCODE_WORKSPACE" \
            --scheme "$XCODE_SCHEME"
```

**ë³€ê²½ ì‚¬í•­**:
1. âœ… `integrations` ì„¤ì • ì¶”ê°€
2. âœ… Flutter ìŠ¤í‚µ ìŠ¤í¬ë¦½íŠ¸ ëª…ì‹œ
3. âœ… ë„¤ì´í‹°ë¸Œ iOS ë¹Œë“œë§Œ ì‹¤í–‰

**ë¹Œë“œ ìƒíƒœ**: ğŸš€ ì§„í–‰ ì¤‘ (Build ID: `6910d9742743dd9b0b94a29a`)

---

## ğŸ“Š ë¹Œë“œ 51-55 ìš”ì•½

| ë¹Œë“œ | ëª©ì  | ì£¼ìš” ë³€ê²½ | ê²°ê³¼ |
|------|------|----------|------|
| 51 | FCM í† í° ì „ì†¡ ê°œì„  | deviceId ì „ì²´ UUID + FCM ì „ì†¡ ì‹œ deviceId í¬í•¨ | âœ… |
| 52 | ë””ë²„ê·¸ ë¡œê·¸ ë·° ì¶”ê°€ | í•˜ë‹¨ ë°˜íˆ¬ëª… í…ìŠ¤íŠ¸ë°•ìŠ¤ (200px) | âŒ í¬ë˜ì‹œ |
| 53 | í¬ë˜ì‹œ ìˆ˜ì • | nil ì²´í¬, weak self, 0 ì²´í¬ | âœ… |
| 54 | Firebase 11.5 ìœ ì§€ | ë¹Œë“œ ë²ˆí˜¸ë§Œ ë³€ê²½ | âŒ Flutter ê°ì§€ |
| 55 | CodeMagic ì„¤ì • ìˆ˜ì • | codemagic.yaml Flutter ìŠ¤í‚µ | ğŸš€ ë¹Œë“œ ì¤‘ |

---

## âœ… ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸ (ë¹Œë“œ 55)

### ì™„ë£Œëœ ê²ƒë“¤
- [x] deviceId ì „ì²´ UUID ì‚¬ìš©
- [x] FCM í† í° ì „ì†¡ ì‹œ deviceId í¬í•¨
- [x] ë””ë²„ê·¸ ë¡œê·¸ ë·° ì¶”ê°€ (í•˜ë‹¨ 200px)
- [x] ë””ë²„ê·¸ ë¡œê·¸ ë·° í¬ë˜ì‹œ ìˆ˜ì •
- [x] Firebase 11.5 ìœ ì§€
- [x] CodeMagic Flutter ê°ì§€ ë¬¸ì œ í•´ê²°
- [x] codemagic.yaml ë„¤ì´í‹°ë¸Œ iOS ëª…ì‹œ

### í…ŒìŠ¤íŠ¸ ëŒ€ê¸°
- [ ] CodeMagic ë¹Œë“œ 55 ì™„ë£Œ
- [ ] TestFlight ì—…ë¡œë“œ í™•ì¸
- [ ] TestFlight ì•± ì„¤ì¹˜
- [ ] ë””ë²„ê·¸ ë¡œê·¸ ë·° í™•ì¸ (í•˜ë‹¨ ê²€ì€ìƒ‰ ë°•ìŠ¤)
- [ ] FCM í† í° ì„œë²„ ì „ì†¡ í™•ì¸
- [ ] í‘¸ì‹œ ì•Œë¦¼ ìˆ˜ì‹  í…ŒìŠ¤íŠ¸

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

1. **CodeMagic ë¹Œë“œ 55 ì™„ë£Œ ëŒ€ê¸°** (ì•½ 3-5ë¶„)
2. **TestFlight ì„¤ì¹˜**
   - ë¹Œë“œ 55 ì„¤ì¹˜
   - í•˜ë‹¨ì— ë””ë²„ê·¸ ë¡œê·¸ ë°•ìŠ¤ í™•ì¸
3. **ì‹¤ì‹œê°„ ë¡œê·¸ í™•ì¸**
   - ğŸš€ ì•± ì‹œì‘ ë¡œê·¸
   - ğŸ“± Device ID ë¡œê·¸
   - ğŸ”¥ FCM í† í° ë°œê¸‰ ë¡œê·¸
   - ğŸ“¤ FCM í† í° ì „ì†¡ ë¡œê·¸
4. **ì„œë²„ DB í™•ì¸**
   - iOS ë””ë°”ì´ìŠ¤ FCM í† í° ì €ì¥ ì—¬ë¶€
   - deviceId ì €ì¥ ì—¬ë¶€
5. **í‘¸ì‹œ ì•Œë¦¼ í…ŒìŠ¤íŠ¸**
   ```bash
   node firebase-messaging.js
   ```

---

**ì‘ì„±ì¼**: 2025-11-10 ì €ë…
**ìµœì¢… ë¹Œë“œ**: 55
**í”„ë¡œì íŠ¸ ìƒíƒœ**: âœ… ëª¨ë“  ì½”ë“œ ìˆ˜ì • ì™„ë£Œ, CodeMagic ë¹Œë“œ ì§„í–‰ ì¤‘
**ë‹¤ìŒ ì‘ì—…**: ë¹Œë“œ 55 ì™„ë£Œ ëŒ€ê¸° â†’ TestFlight ì„¤ì¹˜ â†’ ë””ë²„ê·¸ ë¡œê·¸ í™•ì¸
**ì„±ê³µ ì˜ˆìƒ**: **99%** (ëª¨ë“  ë¬¸ì œ í•´ê²° ì™„ë£Œ)

**CodeMagic ë¹Œë“œ 55 ì§„í–‰ ì¤‘...** ğŸš€

---

## ğŸ”§ ë¹Œë“œ 56: CodeMagic YAML ì™„ì „ ì¬ì‘ì„±

### ë¬¸ì œ
ë¹Œë“œ 55 ì‹¤íŒ¨: âŒ "Failed to install dependencies for pubspec file"
- CodeMagicì´ ì—¬ì „íˆ Flutter ë””íœë˜ì‹œë¥¼ ì„¤ì¹˜í•˜ë ¤ê³  ì‹œë„
- codemagic.yamlì´ ì¸ì‹ë˜ì—ˆì§€ë§Œ (`settingsSource: file`) ì›Œí¬í”Œë¡œìš° íŒŒì‹± ì‹¤íŒ¨ (`fileWorkflowIds: []`)
- í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— `package.json` íŒŒì¼ì´ ìˆì–´ì„œ ì˜ëª» ê°ì§€ë¨

### ê·¼ë³¸ ì›ì¸ ë¶„ì„
1. **CodeMagicì´ codemagic.yamlì„ ì½ì§€ ëª»í•¨**
   ```bash
   $ curl API/apps/...
   settingsSource: file  # âœ… íŒŒì¼ ë°œê²¬
   fileWorkflowIds: []   # âŒ ì›Œí¬í”Œë¡œìš° íŒŒì‹± ì‹¤íŒ¨
   ```

2. **package.json ì¡´ì¬**
   ```bash
   $ ls /Users/admin/SefraiOS/
   -rw-r--r--  package.json  # â† ì´ê²ƒ ë•Œë¬¸ì— í”„ë¡œì íŠ¸ íƒ€ì… ì˜¤ì¸ì‹
   ```
   - Firebase admin SDK ì‚¬ìš©ì„ ìœ„í•œ íŒŒì¼
   - CodeMagicì´ ì´ê±¸ ë³´ê³  Node.js/React Native í”„ë¡œì íŠ¸ë¡œ ê°ì§€

3. **CodeMagic ìƒ˜í”Œ í”„ë¡œì íŠ¸ ë¶„ì„**
   - Native iOS ìƒ˜í”Œ: https://github.com/codemagic-ci-cd/codemagic-sample-projects/tree/main/ios/ios-native-quick-start
   - ìƒ˜í”Œ codemagic.yamlê³¼ êµ¬ì¡° ë¹„êµ

### í•´ê²° ë°©ë²•

#### 1. `.codemagicignore` íŒŒì¼ ìƒì„±
```
package.json
node_modules/
```

#### 2. `codemagic.yaml` ì™„ì „ ì¬ì‘ì„±
CodeMagic ê³µì‹ Native iOS ìƒ˜í”Œê³¼ ë™ì¼í•˜ê²Œ ìˆ˜ì •:

**ì œê±°í•œ ê²ƒë“¤**:
- âŒ Flutter ìŠ¤í‚µ ìŠ¤í¬ë¦½íŠ¸ (ë¶ˆí•„ìš”)
- âŒ APP_STORE_CONNECT_PRIVATE_KEY_BASE64 í™˜ê²½ ë³€ìˆ˜
- âŒ Set up App Store Connect API Key ìŠ¤í¬ë¦½íŠ¸
- âŒ Publish to TestFlight ìˆ˜ë™ ìŠ¤í¬ë¦½íŠ¸

**ì¶”ê°€/ë³€ê²½í•œ ê²ƒë“¤**:
- âœ… `instance_type: mac_mini_m2` (ìµœì‹  ì¸ìŠ¤í„´ìŠ¤)
- âœ… `publishing.app_store_connect` ì„¹ì…˜ ì¶”ê°€
- âœ… `auth: integration` ì‚¬ìš© (í†µí•© ë°©ì‹)
- âœ… `submit_to_testflight: true`
- âœ… ì´ë©”ì¼ ìˆ˜ì‹ ìë¥¼ ì‹¤ì œ ì´ë©”ì¼ë¡œ ë³€ê²½

**ìµœì¢… codemagic.yaml**:
```yaml
workflows:
  ios-sefra-workflow:
    name: iOS Sefra Build
    max_build_duration: 60
    instance_type: mac_mini_m2
    integrations:
      app_store_connect: codemagic
    environment:
      ios_signing:
        distribution_type: app_store
        bundle_identifier: sefra.kr
      vars:
        XCODE_WORKSPACE: "SefraiOS.xcworkspace"
        XCODE_SCHEME: "SefraiOS"
        BUNDLE_ID: "sefra.kr"
      xcode: latest
      cocoapods: default
    scripts:
      - name: Install CocoaPods dependencies
        script: |
          pod install
      - name: Set up provisioning profiles settings on Xcode project
        script: xcode-project use-profiles
      - name: Build ipa for distribution
        script: |
          xcode-project build-ipa \
            --workspace "$CM_BUILD_DIR/$XCODE_WORKSPACE" \
            --scheme "$XCODE_SCHEME"
    artifacts:
      - build/ios/ipa/*.ipa
      - /tmp/xcodebuild_logs/*.log
      - $HOME/Library/Developer/Xcode/DerivedData/**/Build/**/*.app
      - $HOME/Library/Developer/Xcode/DerivedData/**/Build/**/*.dSYM
    publishing:
      email:
        recipients:
          - 01086162553a@gmail.com
        notify:
          success: true
          failure: false
      app_store_connect:
        auth: integration
        submit_to_testflight: true
        submit_to_app_store: false
```

### í•µì‹¬ ê°œì„ ì‚¬í•­
1. **ë” ì´ìƒ Flutter ê´€ë ¨ ìš°íšŒ ì—†ìŒ** - ìˆœìˆ˜ Native iOS ì›Œí¬í”Œë¡œìš°
2. **App Store Connect í†µí•© ì‚¬ìš©** - API í‚¤ ìˆ˜ë™ ì„¤ì • ë¶ˆí•„ìš”
3. **ìë™ TestFlight ì œì¶œ** - publishing ì„¹ì…˜ì—ì„œ ìë™ ì²˜ë¦¬
4. **ìµœì‹  M2 ì¸ìŠ¤í„´ìŠ¤** - ë¹Œë“œ ì†ë„ í–¥ìƒ

### ë³€ê²½ íŒŒì¼
- âœ… `.codemagicignore` ìƒì„±
- âœ… `codemagic.yaml` ì™„ì „ ì¬ì‘ì„±
- âœ… `Info.plist` ë¹Œë“œ ë²ˆí˜¸: 55 â†’ 56
- âœ… `project.pbxproj` CURRENT_PROJECT_VERSION: 55 â†’ 56

**ë¹Œë“œ ìƒíƒœ**: ğŸš€ ì»¤ë°‹ ì¤€ë¹„ ì¤‘
Build ID: `6910d9742743dd9b0b94a29a`
