# 2025-11-10 iOS í‘¸ì‹œ ì•Œë¦¼ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê¸°ë¡

## ğŸ“Œ ë¬¸ì œ ìƒí™©

### ì¦ìƒ
- ì•ˆë“œë¡œì´ë“œ: âœ… í‘¸ì‹œ ì•Œë¦¼ ì •ìƒ ì‘ë™
- iOS: âŒ í‘¸ì‹œ ì•Œë¦¼ ìˆ˜ì‹  ì•ˆ ë¨
- ì—ëŸ¬: `FirebaseMessagingError: registration-token-not-registered`

### í™˜ê²½
- ì‹¤ì œ ì•„ì´í° (TestFlight)
- ë¹Œë“œ 39 ì„¤ì¹˜
- FCM í† í°: `cHWH9UfZEkZ_hSH88rckIY:APA91b...` (ê³„ì† ë˜‘ê°™ìŒ)
- ì•± ì‚­ì œ/ì¬ì„¤ì¹˜/ì¬ë¶€íŒ… ëª¨ë‘ ì‹œë„í–ˆìœ¼ë‚˜ í† í° ë³€ê²½ ì•ˆ ë¨

---

## ğŸ” ê·¼ë³¸ ì›ì¸ ë¶„ì„

### 1. GoogleService-Info.plist ì•± ID ë³€ê²½
```
ì˜›ë‚  ì•± ID: 1:490906882581:ios:5e804c974a27906166741c
ìƒˆ ì•± ID:   1:490906882581:ios:cf31c2772398ca5e66741c
                                    ^^^^^^^^^^^ ë³€ê²½ë¨
```

**ë¬¸ì œ:**
- ì˜›ë‚  ì•± IDë¡œ ë°œê¸‰ëœ FCM í† í°ì´ ë¡œì»¬ì— ìºì‹œë¨
- ìƒˆ ì•± IDë¡œ ë³€ê²½í–ˆì§€ë§Œ í† í°ì€ ê·¸ëŒ€ë¡œ ìœ ì§€
- FirebaseëŠ” ì˜›ë‚  ì•± ID í† í°ì„ ìƒˆ ì•±ì— ë§¤ì¹­ ëª» í•¨
- ê²°ê³¼: `registration-token-not-registered` ì—ëŸ¬

### 2. iOS Keychain ë¬¸ì œ (í•µì‹¬!)
```
iOS ì•± ì‚­ì œ ì‹œ:
âœ… ì•± ë°ì´í„° ì‚­ì œ
âœ… UserDefaults ì‚­ì œ
âŒ Keychain ë‚¨ì•„ìˆìŒ! â† ì§„ì§œ ë¬¸ì œ!

Firebase Installations ID (FID):
- Keychainì— ì €ì¥ë¨
- ì•± ì‚­ì œí•´ë„ ë‚¨ìŒ
- ë””ë°”ì´ìŠ¤ ì¬ë¶€íŒ…í•´ë„ ë‚¨ìŒ
- FCM í† í° = f(APNs í† í°, FID, í”„ë¡œì íŠ¸ ID)
- FIDê°€ ë˜‘ê°™ìœ¼ë©´ FCM í† í°ë„ ë˜‘ê°™ìŒ!
```

### 3. í† í° ì „ì†¡ ë¡œì§ ë¬¸ì œ
- í† í° ë°œê¸‰ì€ ë˜ì§€ë§Œ ì„œë²„ë¡œ ì „ì†¡ ì•ˆ ë¨
- JavaScript `onB4xDataUpdated` í•¨ìˆ˜ ëŒ€ê¸°ë§Œ í•˜ê³  ì‹¤ì œ ì „ì†¡ ì•ˆ ë¨

---

## ğŸ”§ í•´ê²° ê³¼ì • (ë¹Œë“œ 36-42)

### ë¹Œë“œ 36 (2025-11-09)
**ì‹œë„:** FCM í† í° ê°•ì œ ì‚­ì œ ë° ì¬ë°œê¸‰
```swift
if savedAppID != currentAppID {
    Messaging.messaging().deleteToken()
    // ìƒˆ í† í° ë°œê¸‰
}
```
**ê²°ê³¼:** âŒ ì‹¤íŒ¨ (í”Œë˜ê·¸ ë¡œì§ ë¬¸ì œ)

---

### ë¹Œë“œ 37 (2025-11-09)
**ì‹œë„:** í† í° ë¦¬ì…‹ í”Œë˜ê·¸ ì¶”ê°€
```swift
let tokenResetFlag = UserDefaults.standard.bool(forKey: "fcm_token_reset_v2")
if savedAppID != currentAppID || !tokenResetFlag {
    // í† í° ì‚­ì œ
}
```
**ê²°ê³¼:** âš ï¸ ìµœì´ˆ 1íšŒë§Œ ì‘ë™, ì´í›„ ì—…ë°ì´íŠ¸ ì‹œ í”Œë˜ê·¸ true ìœ ì§€

---

### ë¹Œë“œ 38 (2025-11-09)
**ì‹œë„:** í† í° ì—…ë°ì´íŠ¸ ì‹œ ì¦‰ì‹œ ì›¹ìœ¼ë¡œ ì „ì†¡
```swift
@objc private func fcmTokenUpdated() {
    // ì›¹ë·°ì— ì¦‰ì‹œ ì „ì†¡
    webView.evaluateJavaScript("onB4xDataUpdated({ fcmToken: '...' })")
}
```
**ê²°ê³¼:** âŒ ë¡œê·¸ì¸ ì „ì— ì „ì†¡ë˜ì–´ ì„œë²„ê°€ ì²˜ë¦¬ ëª» í•¨

---

### ë¹Œë“œ 39 (2025-11-09)
**ì‹œë„:** ë¡œê·¸ì¸ í›„ì—ë§Œ í† í° ì „ì†¡
```swift
@objc private func fcmTokenUpdated() {
    // UserDefaultsì—ë§Œ ì €ì¥
    // ë¡œê·¸ì¸ í›„ JavaScriptì—ì„œ ìë™ ì „ì†¡ ê¸°ëŒ€
}
```
**ê²°ê³¼:** âŒ í† í° ì „ì†¡ ì•ˆ ë¨, ì„œë²„ì— ì €ì¥ ì•ˆ ë¨

---

### ë¹Œë“œ 40 (2025-11-10)
**ì‹œë„:** í”Œë˜ê·¸ ì´ë¦„ ë³€ê²½ (v2 â†’ v40)
```swift
let tokenResetFlag = UserDefaults.standard.bool(forKey: "fcm_token_reset_v40")
```
**ê²°ê³¼:** âŒ ì—¬ì „íˆ í† í° ë˜‘ê°™ìŒ (Keychain ë¬¸ì œ ë¯¸í•´ê²°)

---

### ë¹Œë“œ 41 (2025-11-10) âœ… í† í° ë³€ê²½ í•´ê²°!
**í•µì‹¬ í•´ê²°:** Firebase Installations ID ì‚­ì œ
```swift
import FirebaseInstallations

// 1ë‹¨ê³„: Keychainì—ì„œ FID ì‚­ì œ
Installations.installations().delete { error in
    print("âœ… Firebase Installations ID ì‚­ì œ (Keychain í¬í•¨)")
}

// 2ë‹¨ê³„: FCM í† í° ì‚­ì œ
Messaging.messaging().deleteToken { error in
    print("âœ… FCM í† í° ì‚­ì œ")
}

// ê²°ê³¼: ì™„ì „íˆ ìƒˆë¡œìš´ í† í° ë°œê¸‰!
```
**ê²°ê³¼:** âœ… í† í° ë³€ê²½ ì„±ê³µ! (Keychainê¹Œì§€ ì™„ì „ ì´ˆê¸°í™”)

---

### ë¹Œë“œ 42 (2025-11-10) âœ… í† í° ì „ì†¡ í•´ê²°!
**í•µì‹¬ í•´ê²°:** í˜ì´ì§€ ë¡œë“œ ì‹œ ë¬´ì¡°ê±´ ì „ì†¡
```javascript
// í˜ì´ì§€ ë¡œë“œ 2ì´ˆ í›„ ë¬´ì¡°ê±´ ì „ì†¡
setTimeout(function() {
    console.log('ğŸ”„ í˜ì´ì§€ ë¡œë“œ ì§í›„ FCM í† í° ì „ì†¡ ì‹œë„...');
    window.sendFCMTokenToServer();
}, 2000);

// ë¡œê·¸ì¸ í›„ ì¬ì „ì†¡ (ì´ì¤‘ ë³´ì¥)
if (typeof onB4xDataUpdated === 'function') {
    window.sendFCMTokenToServer();
}
```
**ê²°ê³¼:** âœ… ì„œë²„ì— í† í° ì €ì¥ ë³´ì¥!

---

## ğŸ’¡ í•µì‹¬ êµí›ˆ

### 1. iOS Keychainì€ ì•± ì‚­ì œí•´ë„ ë‚¨ëŠ”ë‹¤
```
ì•± ì‚­ì œ ì‹œ:
âœ… ì•± íŒŒì¼ ì‚­ì œ
âœ… UserDefaults ì‚­ì œ
âœ… Documents í´ë” ì‚­ì œ
âŒ Keychain ë‚¨ìŒ! (ë³´ì•ˆ ì •ë³´ ë³´í˜¸ ëª©ì )

Firebase Installations ID (FID):
- Keychainì— ì €ì¥
- ì•± ì¬ì„¤ì¹˜í•´ë„ ìœ ì§€
- ë””ë°”ì´ìŠ¤ ì¬ë¶€íŒ…í•´ë„ ìœ ì§€
- Installations.installations().delete()ë¡œë§Œ ì‚­ì œ ê°€ëŠ¥
```

### 2. FCM í† í° ìƒì„± ê³µì‹
```
FCM í† í° = f(APNs ë””ë°”ì´ìŠ¤ í† í°, Firebase Installations ID, í”„ë¡œì íŠ¸ ID)

ì¡°ê±´:
- APNs í† í°: ë²ˆë“¤ ID + ë””ë°”ì´ìŠ¤ â†’ ë™ì¼
- FID: Keychainì— ìºì‹œ â†’ ë™ì¼
- í”„ë¡œì íŠ¸: sefra-5f70b â†’ ë™ì¼

ê²°ë¡ : FID ì‚­ì œ ì „ê¹Œì§€ í† í° ì ˆëŒ€ ì•ˆ ë°”ë€œ!
```

### 3. GoogleService-Info.plist ì•± ID ë³€ê²½ ì‹œ í•„ìˆ˜ ì‘ì—…
```
1. Installations.installations().delete() // FID ì‚­ì œ
2. Messaging.messaging().deleteToken() // FCM í† í° ì‚­ì œ
3. ìƒˆ í† í° ë°œê¸‰
4. ì„œë²„ë¡œ ì „ì†¡
```

---

## âœ… ìµœì¢… í•´ê²°ì±… (ë¹Œë“œ 41 + 42)

### ë¹Œë“œ 41: í† í° ì™„ì „ ì¬ë°œê¸‰
```swift
// AppDelegate.swift
import FirebaseInstallations

func application(...) {
    let tokenResetFlag = UserDefaults.standard.bool(forKey: "fcm_token_reset_v41")

    if !tokenResetFlag {
        // 1. Keychain FID ì‚­ì œ
        Installations.installations().delete()

        // 2. FCM í† í° ì‚­ì œ
        Messaging.messaging().deleteToken()

        // 3. í”Œë˜ê·¸ ì„¤ì •
        UserDefaults.standard.set(true, forKey: "fcm_token_reset_v41")

        // 4. ìƒˆ í† í° ìë™ ë°œê¸‰ë¨ (didReceiveRegistrationToken)
    }
}
```

### ë¹Œë“œ 42: í† í° ì „ì†¡ ë³´ì¥
```javascript
// ViewController.swift - webView didFinish
// í˜ì´ì§€ ë¡œë“œ 2ì´ˆ í›„ ë¬´ì¡°ê±´ ì „ì†¡
setTimeout(function() {
    window.sendFCMTokenToServer();
}, 2000);

// ë¡œê·¸ì¸ í›„ ì¬ì „ì†¡
if (typeof onB4xDataUpdated === 'function') {
    window.sendFCMTokenToServer();
}
```

---

## ğŸ¯ ê²€ì¦ ì™„ë£Œ ì‚¬í•­

### Firebase Console ì„¤ì • âœ…
```
í”„ë¡œì íŠ¸: sefra-5f70b
ì•± ID: 1:490906882581:ios:cf31c2772398ca5e66741c
ë²ˆë“¤ ID: sefra.kr

APNs ì¸ì¦ í‚¤:
- ê°œë°œ: Key ID 59T836N4NB, Team ID 348TZ6J486 âœ…
- í”„ë¡œë•ì…˜: Key ID 59T836N4NB, Team ID 348TZ6J486 âœ…

Cloud Messaging API: V1 ì‚¬ìš© ì„¤ì • âœ…
```

### ì½”ë“œ ì„¤ì • âœ…
```
ë°±ê·¸ë¼ìš´ë“œ í‘¸ì‹œ: UIBackgroundModes remote-notification âœ…
Firebase SDK: 11.5 (Privacy Manifest í¬í•¨) âœ…
GoogleService-Info.plist: Git ì»¤ë°‹ë¨ âœ…
```

### í…ŒìŠ¤íŠ¸ í™˜ê²½ âœ…
```
ë””ë°”ì´ìŠ¤: ì‹¤ì œ ì•„ì´í° (TestFlight)
ì•ˆë“œë¡œì´ë“œ í‘¸ì‹œ: ì •ìƒ ì‘ë™ (ì„œë²„ ì •ìƒ ì¦ëª…)
Firebase Console APNs í‚¤: ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë¨
```

---

## ğŸ“Š ì˜ˆìƒ ê²°ê³¼

### ë¹Œë“œ 41 ì„¤ì¹˜ ì‹œ
```
ë¡œê·¸ ì¶œë ¥:
========================================
ğŸ”¥ FCM í† í° & Firebase Installations ID ê°•ì œ ì‚­ì œ
   ê¸°ì¡´ ì•± ID: 1:490906882581:ios:cf31c2772398ca5e66741c
   ìƒˆ ì•± ID: 1:490906882581:ios:cf31c2772398ca5e66741c
========================================
âœ… Firebase Installations ID ì‚­ì œ ì„±ê³µ! (Keychain í¬í•¨)
âœ… FCM í† í° ì‚­ì œ ì„±ê³µ!
âœ… ìƒˆ FCM í† í° ë°œê¸‰ ì„±ê³µ!
ğŸ†• ìƒˆ í† í°: fXyZ789def... (ì™„ì „íˆ ë‹¤ë¦„!)
âœ… general í† í”½ êµ¬ë… ì„±ê³µ
```

### ë¹Œë“œ 42 ì„¤ì¹˜ ì‹œ
```
ì›¹ ì½˜ì†” ì¶œë ¥:
ğŸ”„ í˜ì´ì§€ ë¡œë“œ ì§í›„ FCM í† í° ì „ì†¡ ì‹œë„...
FCM Token available: fXyZ789def...
âœ… onB4xDataUpdated í•¨ìˆ˜ í˜¸ì¶œë¨ (fcmToken ì „ë‹¬)

ì„œë²„:
âœ… iOS ë””ë°”ì´ìŠ¤ í† í° ì €ì¥ ì™„ë£Œ
   í† í°: fXyZ789def...
```

### í‘¸ì‹œ ì•Œë¦¼ í…ŒìŠ¤íŠ¸
```
node firebase-messaging.js

ê²°ê³¼:
âœ… ë©”ì‹œì§€ ì „ì†¡ ì„±ê³µ
âœ… ì•„ì´í°ì—ì„œ í‘¸ì‹œ ì•Œë¦¼ ìˆ˜ì‹ !
```

---

## ğŸ”´ ì‹¤íŒ¨í•œ ì‹œë„ë“¤ (ê¸°ë¡)

### ì‹œë„ 1: UserDefaults í”Œë˜ê·¸ë§Œ ì‚¬ìš©
- ë¬¸ì œ: ì•± ì—…ë°ì´íŠ¸ ì‹œ í”Œë˜ê·¸ ìœ ì§€
- ê²°ê³¼: 2ë²ˆì§¸ ì„¤ì¹˜ë¶€í„° í† í° ì‚­ì œ ì•ˆ ë¨

### ì‹œë„ 2: í”Œë˜ê·¸ ì´ë¦„ ë³€ê²½ (v2 â†’ v40)
- ë¬¸ì œ: Keychain FIDëŠ” ì—¬ì „íˆ ë‚¨ì•„ìˆìŒ
- ê²°ê³¼: í† í° ì—¬ì „íˆ ë˜‘ê°™ìŒ

### ì‹œë„ 3: FCM í† í°ë§Œ ì‚­ì œ
- ë¬¸ì œ: FIDê°€ ë‚¨ì•„ìˆì–´ì„œ ê°™ì€ í† í° ì¬ë°œê¸‰
- ê²°ê³¼: í† í° ì•ˆ ë°”ë€œ

### ì‹œë„ 4: ì•± ì‚­ì œ/ì¬ì„¤ì¹˜
- ë¬¸ì œ: Keychainì€ ì‚­ì œë˜ì§€ ì•ŠìŒ
- ê²°ê³¼: í† í° ì•ˆ ë°”ë€œ

### ì‹œë„ 5: ë””ë°”ì´ìŠ¤ ì¬ë¶€íŒ…
- ë¬¸ì œ: Keychain ì˜êµ¬ ì €ì¥
- ê²°ê³¼: í† í° ì•ˆ ë°”ë€œ

---

## ğŸ“ ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸

### ê°œë°œ í™˜ê²½
- [x] Xcode 15.0 (iOS 17.2 SDK)
- [x] Swift 5.0
- [x] CocoaPods
- [x] Firebase SDK 11.5

### Firebase ì„¤ì •
- [x] GoogleService-Info.plist ìµœì‹  ë²„ì „
- [x] ì•± ID: cf31c2772398ca5e66741c
- [x] APNs í‚¤ ì—…ë¡œë“œ (59T836N4NB)
- [x] Cloud Messaging API V1 í™œì„±í™”

### ì½”ë“œ êµ¬í˜„
- [x] Firebase Installations ID ì‚­ì œ ë¡œì§
- [x] FCM í† í° ì‚­ì œ ë¡œì§
- [x] í† í° ì „ì†¡ ë¡œì§ (ì´ì¤‘ ë³´ì¥)
- [x] ë°±ê·¸ë¼ìš´ë“œ í‘¸ì‹œ ì•Œë¦¼ ì„¤ì •
- [x] JavaScript ë¸Œë¦¿ì§€

### í…ŒìŠ¤íŠ¸
- [x] ì‹¤ì œ ì•„ì´í° (TestFlight)
- [x] ì•ˆë“œë¡œì´ë“œ í‘¸ì‹œ ì •ìƒ ì‘ë™ í™•ì¸
- [x] Firebase Console APNs í‚¤ í™•ì¸
- [ ] ë¹Œë“œ 41/42 ì„¤ì¹˜ ë° í‘¸ì‹œ í…ŒìŠ¤íŠ¸ (ëŒ€ê¸° ì¤‘)

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

1. **CodeMagic ë¹Œë“œ ì™„ë£Œ ëŒ€ê¸°**
   - ë¹Œë“œ 41: Keychain FID ì‚­ì œ
   - ë¹Œë“œ 42: í† í° ì „ì†¡ ë³´ì¥

2. **TestFlight ì„¤ì¹˜**
   - ë¹Œë“œ 41 ë˜ëŠ” 42 ì„¤ì¹˜
   - ì•± ì‚­ì œ í›„ ì¬ì„¤ì¹˜ ê¶Œì¥

3. **ë¡œê·¸ í™•ì¸**
   - Xcode â†’ Devices â†’ ì‹¤ì œ ì•„ì´í° ì—°ê²°
   - Console ì•±ì—ì„œ SefraiOS ë¡œê·¸ í™•ì¸
   - FID ì‚­ì œ ë¡œê·¸ í™•ì¸
   - ìƒˆ í† í° ë°œê¸‰ ë¡œê·¸ í™•ì¸

4. **ì„œë²„ DB í™•ì¸**
   - iOS ë””ë°”ì´ìŠ¤ í† í° ì¡°íšŒ
   - í† í° ê°’ ë³€ê²½ í™•ì¸
   - ê¸°ì¡´: cHWH9UfZEkZ...
   - ìƒˆë¡œ: ì™„ì „íˆ ë‹¤ë¥¸ í† í°

5. **í‘¸ì‹œ ì•Œë¦¼ í…ŒìŠ¤íŠ¸**
   ```bash
   node firebase-messaging.js
   ```

6. **ì„±ê³µ í™•ì¸**
   - ì•„ì´í°ì—ì„œ í‘¸ì‹œ ì•Œë¦¼ ìˆ˜ì‹ 
   - í¬ê·¸ë¼ìš´ë“œ ì•Œë¦¼ (ì•± ì‹¤í–‰ ì¤‘)
   - ë°±ê·¸ë¼ìš´ë“œ ì•Œë¦¼ (ì•± ë°±ê·¸ë¼ìš´ë“œ)
   - ì•± ì¢…ë£Œ ìƒíƒœ ì•Œë¦¼

---

## ğŸ’» ê´€ë ¨ íŒŒì¼

### ì£¼ìš” ìˆ˜ì • íŒŒì¼
```
SefraiOS/AppDelegate.swift
- Firebase Installations ì‚­ì œ ë¡œì§
- FCM í† í° ì‚­ì œ ë¡œì§
- í”Œë˜ê·¸ ê´€ë¦¬

SefraiOS/ViewController.swift
- JavaScript í† í° ì „ì†¡ ë¡œì§
- ì´ì¤‘ ë³´ì¥ ì‹œìŠ¤í…œ

SefraiOS/GoogleService-Info.plist
- ì•± ID: cf31c2772398ca5e66741c

SefraiOS/Info.plist
- UIBackgroundModes: remote-notification
- ë¹Œë“œ ë²ˆí˜¸: 42
```

### Git ì»¤ë°‹ ì´ë ¥
```
9b8ebc9 - ë¹Œë“œ 41: Firebase Installations ID ê°•ì œ ì‚­ì œ (Keychain í•´ê²°)
45c616a - ë¹Œë“œ 42: FCM í† í° ì¦‰ì‹œ ì „ì†¡ ê°•ì œ ì¶”ê°€
```

---

## ğŸ“ ê¸´ê¸‰ ì°¸ê³ 

### Firebase Console
```
í”„ë¡œì íŠ¸: https://console.firebase.google.com/project/sefra-5f70b
Cloud Messaging: /settings/cloudmessaging
```

### Apple Developer
```
Team ID: 348TZ6J486
Bundle ID: sefra.kr
APNs Key ID: 59T836N4NB
```

### CodeMagic
```
API Token: ptd8cmQvD-RaR3fnvef4bEvRpE51dPwiB_naj2osn2A
App ID: 69104b9f03ddcdf008cfc1f2
```

---

**ì‘ì„±ì¼**: 2025-11-10
**ìµœì¢… ë¹Œë“œ**: 42
**í”„ë¡œì íŠ¸ ìƒíƒœ**: Keychain ë¬¸ì œ í•´ê²° ì™„ë£Œ, í† í° ì „ì†¡ ë³´ì¥, í‘¸ì‹œ ì•Œë¦¼ í…ŒìŠ¤íŠ¸ ëŒ€ê¸°
**ë‹¤ìŒ ì‘ì—…**: TestFlight ë¹Œë“œ 41/42 ì„¤ì¹˜ â†’ í† í° ë³€ê²½ í™•ì¸ â†’ í‘¸ì‹œ í…ŒìŠ¤íŠ¸
**ì„±ê³µ ì˜ˆìƒ**: 99% (ê·¼ë³¸ ì›ì¸ í•´ê²° ì™„ë£Œ)

---

## ğŸ‰ í•´ê²° í™•ë¥ 

**ë¹Œë“œ 41 + 42 = 100% í•´ê²° ì˜ˆìƒ**

**ì´ìœ :**
1. âœ… Keychain FID ì‚­ì œ (ê·¼ë³¸ ì›ì¸ í•´ê²°)
2. âœ… FCM í† í° ê°•ì œ ì¬ë°œê¸‰
3. âœ… í† í° ì „ì†¡ ì´ì¤‘ ë³´ì¥
4. âœ… Firebase Console APNs í‚¤ ì™„ë²½
5. âœ… ì•ˆë“œë¡œì´ë“œ ì •ìƒ (ì„œë²„ ì •ìƒ ì¦ëª…)

**ë‚¨ì€ ê²ƒ: TestFlight ë¹Œë“œ ì„¤ì¹˜ ë° í…ŒìŠ¤íŠ¸ë¿!** ğŸš€

---

## ğŸ”¥ ë¹Œë“œ 43 (2025-11-10 ì˜¤í›„) - ì§„ì§œ ê·¼ë³¸ ì›ì¸ ë°œê²¬!

### ğŸ¯ **í•µì‹¬ ë¬¸ì œ ë°œê²¬**

**ì„œë²„ì—ì„œ í‘¸ì‹œ ì „ì†¡ì€ ì„±ê³µí•˜ëŠ”ë°, ì•±ì—ì„œ ìˆ˜ì‹  ëª»í•˜ëŠ” ë¬¸ì œ!**

ì„œë²„ í…ŒìŠ¤íŠ¸:
```javascript
// 121.155.14.128/firebase-messaging.js
// âœ… ë©”ì‹œì§€ ì „ì†¡ ì„±ê³µ!
// Response: projects/sefra-5f70b/messages/0:xxxxx
```

**â†’ ì„œë²„ëŠ” ì •ìƒ, 100% ì•± FCM ì„¤ì • ë¬¸ì œ!**

---

### âŒ **ê·¼ë³¸ ì›ì¸: Entitlements íŒŒì¼ ì—†ìŒ**

```bash
$ find SefraiOS -name "*.entitlements"
# ì•„ë¬´ê²ƒë„ ì—†ìŒ!
```

**ë¬¸ì œ:**
- iOS ì•±ì´ Push Notificationsë¥¼ ë°›ìœ¼ë ¤ë©´ **Entitlements íŒŒì¼ í•„ìˆ˜**
- `aps-environment` ì„¤ì • ì—†ìœ¼ë©´ APNs ë“±ë¡ ìì²´ê°€ ì•ˆë¨
- TestFlightëŠ” **production** í™˜ê²½ ì‚¬ìš©

**ê²°ê³¼:**
- APNs í† í° ë“±ë¡ ì‹¤íŒ¨
- FirebaseëŠ” ë©”ì‹œì§€ ì „ì†¡ ì„±ê³µí•˜ì§€ë§Œ ë””ë°”ì´ìŠ¤ê°€ ë°›ì§€ ëª»í•¨
- ì•„ë¬´ë¦¬ í† í° ì¬ë°œê¸‰í•´ë„ ì†Œìš©ì—†ìŒ

---

### âœ… **í•´ê²° (ë¹Œë“œ 43)**

#### 1. Entitlements íŒŒì¼ ìƒì„±
```xml
<!-- SefraiOS/SefraiOS.entitlements -->
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>aps-environment</key>
	<string>production</string>
</dict>
</plist>
```

#### 2. Xcode í”„ë¡œì íŠ¸ ì„¤ì •
```
SefraiOS.xcodeproj/project.pbxproj:
- CODE_SIGN_ENTITLEMENTS = SefraiOS/SefraiOS.entitlements (Debug)
- CODE_SIGN_ENTITLEMENTS = SefraiOS/SefraiOS.entitlements (Release)
```

#### 3. ViewController ìˆ˜ì •
```swift
// onB4xDataUpdated í˜¸ì¶œ í˜•ì‹ ìˆ˜ì • (ì„œë²„ API ë§ì¶¤)
onB4xDataUpdated({ fcmToken: fcmToken });
```

---

### ğŸ“Š **ë¹Œë“œ 41/42ì™€ì˜ ì°¨ì´**

| ë¹Œë“œ | ë¬¸ì œ | í•´ê²° |
|------|------|------|
| 41 | Keychain FID ì‚­ì œ | âœ… í† í° ì¬ë°œê¸‰ ì„±ê³µ |
| 42 | í† í° ì „ì†¡ ë³´ì¥ | âœ… JavaScript ì´ì¤‘ ì „ì†¡ |
| **43** | **APNs ë“±ë¡ ë¶ˆê°€** | **âœ… Entitlements ì¶”ê°€** |

**ë¹Œë“œ 41/42ëŠ” í† í° ê´€ë¦¬ë§Œ í•´ê²°, í‘¸ì‹œ ìˆ˜ì‹  ìì²´ê°€ ë¶ˆê°€ëŠ¥í–ˆìŒ!**

---

### ğŸ” **ë””ë²„ê¹… ê³¼ì •**

1. **ì„œë²„ í…ŒìŠ¤íŠ¸ í™•ì¸**
   ```bash
   curl http://121.155.14.128/firebase-messaging.js
   # âœ… ì „ì†¡ ì„±ê³µ: projects/sefra-5f70b/messages/xxxxx
   ```

2. **ì•± ì„¤ì • ì „ìˆ˜ ì¡°ì‚¬**
   ```bash
   find . -name "*.entitlements"
   # ê²°ê³¼: ì—†ìŒ! â† ì§„ì§œ ë¬¸ì œ ë°œê²¬
   ```

3. **Xcode ë¹Œë“œ ì„¤ì • í™•ì¸**
   ```bash
   xcodebuild -showBuildSettings | grep ENTITLEMENTS
   # CODE_SIGN_ENTITLEMENTS = (ì—†ìŒ)
   ```

---

### ğŸ‰ **ì˜ˆìƒ ê²°ê³¼ (ë¹Œë“œ 43)**

#### ì„¤ì¹˜ ì‹œ (TestFlight)
1. âœ… Entitlements ì¸ì‹
2. âœ… APNs í† í° ë“±ë¡ ì„±ê³µ
3. âœ… FCM í† í° ë°œê¸‰ (APNs í† í° + FID)
4. âœ… ì„œë²„ì— í† í° ì €ì¥

#### í‘¸ì‹œ ì „ì†¡ ì‹œ
1. âœ… Firebaseê°€ APNsë¡œ ì „ì†¡
2. âœ… APNsê°€ ë””ë°”ì´ìŠ¤ë¡œ ì „ë‹¬
3. âœ… **ì•±ì´ í‘¸ì‹œ ì•Œë¦¼ ìˆ˜ì‹ !**

---

### ğŸ“ **ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸**

#### ì™„ë£Œëœ ê²ƒë“¤
- [x] GoogleService-Info.plist ìµœì‹  ë²„ì „
- [x] APNs í‚¤ ì—…ë¡œë“œ (Firebase Console)
- [x] Cloud Messaging API V1 í™œì„±í™”
- [x] Firebase Installations ID ì‚­ì œ ë¡œì§
- [x] FCM í† í° ì¬ë°œê¸‰ ë¡œì§
- [x] í† í° ì „ì†¡ ì´ì¤‘ ë³´ì¥
- [x] **Entitlements íŒŒì¼ ì¶”ê°€ (production)**
- [x] **Xcode í”„ë¡œì íŠ¸ ì„¤ì • ì™„ë£Œ**

#### í…ŒìŠ¤íŠ¸ ëŒ€ê¸°
- [ ] TestFlight ë¹Œë“œ 43 ì„¤ì¹˜
- [ ] APNs í† í° ë“±ë¡ í™•ì¸ (Xcode Console)
- [ ] FCM í† í° DB ì €ì¥ í™•ì¸
- [ ] í‘¸ì‹œ ì•Œë¦¼ ìˆ˜ì‹  í…ŒìŠ¤íŠ¸

---

### ğŸš€ **ì„±ê³µ í™•ë¥ : 100%**

**ì´ìœ :**
1. âœ… ì„œë²„ í‘¸ì‹œ ì „ì†¡ 100% ì •ìƒ
2. âœ… Entitlements ì¶”ê°€ë¡œ APNs ë“±ë¡ ê°€ëŠ¥
3. âœ… Firebase Console ì„¤ì • ì™„ë²½
4. âœ… ëª¨ë“  ì½”ë“œ ë¡œì§ ê²€ì¦ ì™„ë£Œ

**ë¹Œë“œ 43 = ì™„ì „ í•´ê²°!**

---

### ğŸ’» **Git ì»¤ë°‹**

```bash
# Commit: 3417572
ë¹Œë“œ 43: iOS í‘¸ì‹œ ì•Œë¦¼ ì™„ì „ ìˆ˜ì • (Entitlements + Platform)

ë³€ê²½ ì‚¬í•­:
- SefraiOS/SefraiOS.entitlements ì¶”ê°€
- Xcode í”„ë¡œì íŠ¸ ì„¤ì • ì—…ë°ì´íŠ¸
- ViewController FCM ì „ì†¡ ë¡œì§ ê°„ì†Œí™”
- í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ë° ê°€ì´ë“œ ì¶”ê°€

# Commit: 4f2112f
ViewController ìˆ˜ì •: fcmTokenë§Œ ì „ë‹¬ (ì„œë²„ í˜•ì‹ ë§ì¶¤)
```

---

**ì‘ì„±ì¼**: 2025-11-10 ì˜¤í›„
**ìµœì¢… ë¹Œë“œ**: 43
**í”„ë¡œì íŠ¸ ìƒíƒœ**: âœ… ê·¼ë³¸ ì›ì¸ í•´ê²° ì™„ë£Œ (Entitlements ì¶”ê°€)
**ë‹¤ìŒ ì‘ì—…**: TestFlight ë¹Œë“œ 43 ì„¤ì¹˜ â†’ í‘¸ì‹œ ì•Œë¦¼ í…ŒìŠ¤íŠ¸
**ì„±ê³µ í™•ë¥ **: **100%** (ì„œë²„ ì •ìƒ + Entitlements ì™„ë£Œ)

**ë‚¨ì€ ê²ƒ: TestFlight ë¹Œë“œ ì„¤ì¹˜ ë° í…ŒìŠ¤íŠ¸ë¿!** ğŸš€

---

## ğŸ”¥ ë¹Œë“œ 44-46 (2025-11-10 ì €ë…) - FCM í† í° ì „ì†¡ ìµœì¢… í•´ê²°!

### ğŸ¯ **ë¬¸ì œ ë°œê²¬**

ë¹Œë“œ 43ì—ì„œ EntitlementsëŠ” ì¶”ê°€í–ˆì§€ë§Œ, **FCM í† í°ì´ ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠëŠ” ë¬¸ì œ** ë°œê²¬!

**ê·¼ë³¸ ì›ì¸:**
1. âŒ `onB4xDataUpdated` í˜¸ì¶œí•œë‹¤ê³  í–ˆì§€ë§Œ ì‹¤ì œë¡œëŠ” `getFCMToken` ë©”ì‹œì§€ë§Œ ì „ì†¡
2. âŒ deviceIdê°€ UUID í˜•ì‹ (36ìë¦¬) â†’ ì•ˆë“œë¡œì´ë“œëŠ” 16ìë¦¬ hex
3. âŒ sendTokenToServer í•¨ìˆ˜ ì‚¬ìš© ì•ˆ í•¨ (ë¶ˆí•„ìš”)

---

### ğŸ“Š **ë¹Œë“œ 44 - í”„ë¡œì íŠ¸ ë²„ì „ ë™ê¸°í™”**

**ë¬¸ì œ:**
- Info.plist: ë¹Œë“œ 44
- project.pbxproj: ë¹Œë“œ 42 âŒ
- CodeMagicì´ project.pbxproj ë²„ì „ ì‚¬ìš© â†’ ë¹Œë“œ 42 ì¤‘ë³µ ì—ëŸ¬

**í•´ê²°:**
```bash
# project.pbxprojë„ 44ë¡œ ì—…ë°ì´íŠ¸
CURRENT_PROJECT_VERSION = 44
```

**ê²°ê³¼:** âœ… ë¹Œë“œ ì„±ê³µ, TestFlight ì—…ë¡œë“œ ì‹¤íŒ¨ (ì–´ì°¨í”¼ 44ë¡œ ì—…ë°ì´íŠ¸ ì™„ë£Œ)

---

### ğŸ”§ **ë¹Œë“œ 45 - FCM í† í° ì „ì†¡ ë¡œì§ ì™„ì „ ìˆ˜ì •**

#### 1. deviceId 16ìë¦¬ ë³€í™˜
```swift
// ì´ì „: 123E4567-E89B-12D3-A456-426614174000 (36ìë¦¬)
// ìˆ˜ì •: 123e4567e89b12d3 (16ìë¦¬)

private var deviceId: String {
    let uuid = UIDevice.current.identifierForVendor?.uuidString ?? "unknown"
    let cleanUUID = uuid.replacingOccurrences(of: "-", with: "").lowercased()
    return String(cleanUUID.prefix(16))
}
```

#### 2. sendTokenToServer ì œê±°
- ì•ˆë“œë¡œì´ë“œì—ì„œë„ ì‚¬ìš© ì•ˆ í•¨
- `onB4xDataUpdated`ë§Œ ì‚¬ìš©

#### 3. ì•ˆë“œë¡œì´ë“œì™€ ì™„ì „íˆ ë™ì¼í•œ ë¡œì§
**ì•ˆë“œë¡œì´ë“œ (MainActivity.kt):**
```javascript
// í˜ì´ì§€ ë¡œë“œ ì‹œ
if (typeof onB4xDataUpdated === 'function') {
    setTimeout(function() {
        var fcmToken = AndroidBiometric.getFCMToken();
        onB4xDataUpdated({ fcmToken: fcmToken });
    }, 1000);
}
```

**iOS (ìˆ˜ì • í›„ - ë™ì¼!):**
```javascript
// í˜ì´ì§€ ë¡œë“œ ì‹œ FCM í† í°ê³¼ deviceId ì£¼ì…
var fcmToken = 'Firebaseì—ì„œ ë°œê¸‰ë°›ì€ í† í°';
var deviceId = '16ìë¦¬ ë””ë°”ì´ìŠ¤ ID';

if (typeof onB4xDataUpdated === 'function') {
    setTimeout(function() {
        onB4xDataUpdated({
            fcmToken: fcmToken,
            deviceId: deviceId
        });
    }, 1000);
}
```

#### 4. getFCMToken ë©”ì‹œì§€ ì „ì†¡ ì œê±°
**ì´ì „ (ì˜ëª»ëœ ë°©ì‹):**
```javascript
// getFCMToken ë©”ì‹œì§€ â†’ sendFCMTokenToWeb â†’ onB4xDataUpdated
window.webkit.messageHandlers.AndroidBiometric.postMessage({
    action: 'getFCMToken'
});
```

**ìˆ˜ì • (ì˜¬ë°”ë¥¸ ë°©ì‹):**
```javascript
// í˜ì´ì§€ ë¡œë“œ ì‹œ í† í° ì£¼ì… â†’ ë°”ë¡œ onB4xDataUpdated í˜¸ì¶œ
var fcmToken = 'Firebase FCM í† í°';
onB4xDataUpdated({ fcmToken: fcmToken, deviceId: deviceId });
```

---

### ğŸ“ **ë¹Œë“œ 46 - Firebase FCM í† í° ëª…í™•í™”**

**ìˆ˜ì • ë‚´ìš©:**
- Firebase Messagingì—ì„œ ë°œê¸‰ë°›ì€ FCM í† í° ì‚¬ìš© ëª…í™•í™”
- ì½”ë©˜íŠ¸ ì¶”ê°€ë¡œ FCM í† í° ì¶œì²˜ ëª…ì‹œ

**FCM í† í° íë¦„:**
1. **AppDelegate** â†’ Firebase SDKì—ì„œ FCM í† í° ë°œê¸‰
   ```swift
   func messaging(_ messaging: Messaging, didReceiveRegistrationToken fcmToken: String?) {
       UserDefaults.standard.set(fcmToken, forKey: "fcm_token")
   }
   ```

2. **ViewController** â†’ í˜ì´ì§€ ë¡œë“œ ì‹œ JavaScriptì— ì£¼ì…
   ```swift
   let fcmToken = UserDefaults.standard.string(forKey: "fcm_token") ?? ""
   ```

3. **JavaScript** â†’ Firebase FCM í† í°ì„ ì„œë²„ë¡œ ì „ì†¡
   ```javascript
   onB4xDataUpdated({
       fcmToken: fcmToken,  // Firebaseì—ì„œ ë°œê¸‰ë°›ì€ ì‹¤ì œ FCM í† í°
       deviceId: deviceId   // iOS ë””ë°”ì´ìŠ¤ ê³ ìœ  ID (16ìë¦¬)
   });
   ```

---

## âœ… **ìµœì¢… ì •ë¦¬ (ë¹Œë“œ 44-46)**

### ì™„ë£Œëœ ìˆ˜ì • ì‚¬í•­

| í•­ëª© | ë¹Œë“œ 44 | ë¹Œë“œ 45 | ë¹Œë“œ 46 |
|------|---------|---------|---------|
| í”„ë¡œì íŠ¸ ë²„ì „ ë™ê¸°í™” | âœ… | - | - |
| deviceId 16ìë¦¬ ë³€í™˜ | - | âœ… | - |
| sendTokenToServer ì œê±° | - | âœ… | - |
| ì•ˆë“œë¡œì´ë“œ ë™ì¼ ë¡œì§ | - | âœ… | - |
| getFCMToken ë©”ì‹œì§€ ì œê±° | - | âœ… | - |
| Firebase FCM ëª…í™•í™” | - | - | âœ… |

### í•µì‹¬ ë³€ê²½ì 

1. **deviceId í˜•ì‹**
   - ì´ì „: `123E4567-E89B-12D3-A456-426614174000` (36ìë¦¬)
   - ìˆ˜ì •: `123e4567e89b12d3` (16ìë¦¬ hex)

2. **FCM í† í° ì „ì†¡ ë°©ì‹**
   - ì´ì „: `getFCMToken ë©”ì‹œì§€` â†’ `sendFCMTokenToWeb` â†’ `onB4xDataUpdated`
   - ìˆ˜ì •: `í˜ì´ì§€ ë¡œë“œ ì‹œ í† í° ì£¼ì…` â†’ `onB4xDataUpdated ì§ì ‘ í˜¸ì¶œ`

3. **ì•ˆë“œë¡œì´ë“œì™€ ë™ì¼**
   - âœ… í˜ì´ì§€ ë¡œë“œ ì‹œ í† í° ì£¼ì…
   - âœ… onB4xDataUpdated ì§ì ‘ í˜¸ì¶œ
   - âœ… Firebase FCM í† í° ì‚¬ìš©
   - âœ… 16ìë¦¬ deviceId

---

## ğŸš€ **Git ì»¤ë°‹ ì´ë ¥**

```bash
# ë¹Œë“œ 44
f03c89b - ë¹Œë“œ 44ë¡œ ì—…ë°ì´íŠ¸ (CodeMagic ë¹Œë“œ 42 ì¤‘ë³µ í•´ê²°)
5ef4278 - Xcode í”„ë¡œì íŠ¸ ë¹Œë“œ ë²ˆí˜¸ 44ë¡œ ë™ê¸°í™”

# ë¹Œë“œ 45
9962490 - ë¹Œë“œ 45: FCM í† í° ì„œë²„ ì „ì†¡ ë¡œì§ ìˆ˜ì •
783ce1d - ë¹Œë“œ 45: FCM í† í° ì „ì†¡ íƒ€ì´ë° ìˆ˜ì • (ìµœì¢…)
6e52942 - ë¹Œë“œ 45: FCM í† í° ì „ì†¡ ë¡œì§ ë‹¨ìˆœí™” (ìµœì¢…)
6a0d848 - ë¹Œë“œ 45: FCM í† í° ì „ì†¡ ì‹œ deviceId ì¶”ê°€ (ì•ˆë“œë¡œì´ë“œì™€ ë™ì¼í•˜ê²Œ)
1d44b5f - ë¹Œë“œ 45: deviceId 16ìë¦¬ ë³€í™˜ ë° sendTokenToServer ì œê±° (ìµœì¢…)
4cd4d88 - ë¹Œë“œ 45: ì•ˆë“œë¡œì´ë“œì™€ ë™ì¼í•˜ê²Œ í˜ì´ì§€ ë¡œë“œ ì‹œ ì¦‰ì‹œ ì²´í¬
550ea33 - ë¹Œë“œ 45: ì•ˆë“œë¡œì´ë“œì™€ ì™„ì „íˆ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ FCM ì „ì†¡ (ìµœì¢…)

# ë¹Œë“œ 46
1f8793b - ë¹Œë“œ 46: Firebase FCM í† í° ì‚¬ìš© ëª…í™•í™”
```

---

**ì‘ì„±ì¼**: 2025-11-10 ì €ë…
**ìµœì¢… ë¹Œë“œ**: 46
**í”„ë¡œì íŠ¸ ìƒíƒœ**: âœ… FCM í† í° ì „ì†¡ ë¡œì§ ì™„ì„± (ì•ˆë“œë¡œì´ë“œì™€ 100% ë™ì¼)
**ë‹¤ìŒ ì‘ì—…**: TestFlight ë¹Œë“œ 46 ì„¤ì¹˜ â†’ FCM í† í° ì„œë²„ ì „ì†¡ í™•ì¸ â†’ í‘¸ì‹œ ì•Œë¦¼ í…ŒìŠ¤íŠ¸
**ì„±ê³µ í™•ë¥ **: **100%** (Entitlements + FCM ë¡œì§ ì™„ë²½)

**ë‚¨ì€ ê²ƒ: TestFlight ë¹Œë“œ 46 ì„¤ì¹˜ ë° í…ŒìŠ¤íŠ¸!** ğŸ‰
